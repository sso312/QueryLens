category,자연어 질의,sql_pattern_oracle,tables_used,join_keys,notes,SQL 실행결과,
cohort,"중환자실에 들어간 성인 환자들에 대해, 해당 입원과 ICU 입실 기록 목록을 뽑아줘.","SELECT
  a.subject_id,
  a.hadm_id,
  i.stay_id,
  p.anchor_age,
  a.admittime,
  a.dischtime,
  i.intime,
  i.outtime
FROM SSO.ADMISSIONS a
JOIN SSO.PATIENTS p
  ON p.subject_id = a.subject_id
JOIN SSO.ICUSTAYS i
  ON i.hadm_id = a.hadm_id
WHERE p.anchor_age >= 18;",SSO.ADMISSIONS;SSO.PATIENTS;SSO.ICUSTAYS,subject_id;hadm_id,연령은 patients.anchor_age 사용(버전에 따라 core/hosp 위치가 다를 수 있음).,,
cohort,"성인 환자만 대상으로 해서, 환자마다 첫 번째 입원 기록만 남겨서 코호트를 만들어줘.","WITH first_admit AS (
  SELECT subject_id, MIN(admittime) AS first_admittime
  FROM SSO.ADMISSIONS
  GROUP BY subject_id
)
SELECT
  a.subject_id,
  a.hadm_id,
  a.admittime,
  a.dischtime,
  p.anchor_age
FROM SSO.ADMISSIONS a
JOIN first_admit f
  ON f.subject_id = a.subject_id
 AND f.first_admittime = a.admittime
JOIN SSO.PATIENTS p
  ON p.subject_id = a.subject_id
WHERE p.anchor_age >= 18;",SSO.ADMISSIONS;SSO.PATIENTS,subject_id,동일 환자 다수 입원 중 최초 입원만 선택.,,
cohort,각 입원에 대해 퇴원 후 30일 안에 다시 입원했는지(30일 재입원) 표시해줘.,"SELECT
  a1.hadm_id,
  a1.subject_id,
  CASE WHEN EXISTS (
    SELECT 1
    FROM SSO.ADMISSIONS a2
    WHERE a2.subject_id = a1.subject_id
      AND a2.admittime BETWEEN a1.dischtime AND a1.dischtime + 30
      AND a2.hadm_id <> a1.hadm_id
  ) THEN 1 ELSE 0 END AS readmit_30d_flag
FROM SSO.ADMISSIONS a1;",SSO.ADMISSIONS,subject_id,같은 테이블 self-reference(별칭 a1/a2)로 후속 입원 존재 여부 확인.,,
cohort,병원에 7일 이상 입원했던 케이스만 포함해줘,"SELECT
  hadm_id,
  subject_id,
  admittime,
  dischtime
FROM SSO.ADMISSIONS
WHERE dischtime >= admittime + 7;",SSO.ADMISSIONS,hadm_id,Oracle/DB에 따라 날짜 덧셈 단위(일) 확인 필요.,,
cohort,"한 입원 안에 중환자실 입원기록이 여러 개면, 그중 첫 번째 중환자실 입원기록만 남겨줘.","WITH ranked AS (
  SELECT
    hadm_id,
    stay_id,
    intime,
    outtime,
    ROW_NUMBER() OVER (PARTITION BY hadm_id ORDER BY intime) AS rn
  FROM SSO.ICUSTAYS
)
SELECT hadm_id, stay_id, intime, outtime
FROM ranked
WHERE rn = 1;",SSO.ICUSTAYS,hadm_id,입원당 ICU stay가 여러 개인 경우 대표 stay를 선택하는 패턴.,,
cohort,입원 경로 기반으로 응급실에서 들어온 입원만 뽑아줘,"SELECT
  hadm_id,
  subject_id,
  admittime,
  admission_location
FROM SSO.ADMISSIONS
WHERE LOWER(admission_location) LIKE '%emergency%';",SSO.ADMISSIONS,hadm_id,admission_location 값은 기관/버전 따라 다를 수 있어 LIKE로 시작.,,
cohort,최종 코호트에서 성별(남/여) 분포를 집계해줘,"SELECT
  p.gender,
  COUNT(DISTINCT a.hadm_id) AS hadm_cnt
FROM SSO.ADMISSIONS a
JOIN SSO.PATIENTS p
  ON p.subject_id = a.subject_id
GROUP BY p.gender;",SSO.ADMISSIONS;SSO.PATIENTS,subject_id,성별은 patients.gender.,,
cohort,입원 중 담당 진료과가 내과인 경우만 포함해줘.,"SELECT
  a.hadm_id,
  a.subject_id,
  s.transfertime,
  s.curr_service
FROM SSO.ADMISSIONS a
JOIN SSO.SERVICES s
  ON s.hadm_id = a.hadm_id
WHERE s.curr_service = 'MED';",SSO.ADMISSIONS;SSO.SERVICES,hadm_id,services는 입원 중 진료과/서비스 변화 추적에 사용.,,
cohort,특정 진단코드가 있는 입원만 골라서 코호트를 만들고 싶어(예: I50% 심부전).,"SELECT DISTINCT
  d.hadm_id,
  d.subject_id,
  d.icd_code,
  d.icd_version
FROM SSO.DIAGNOSES_ICD d
WHERE d.icd_code LIKE 'I50%';",SSO.DIAGNOSES_ICD,hadm_id;subject_id,ICD-9/10 혼재 가능 -> icd_version 확인 권장.,,
cohort,"신생아/소아는 제외하고, 성인만 남겨줘.","SELECT
  a.hadm_id,
  a.subject_id,
  p.anchor_age
FROM SSO.ADMISSIONS a
JOIN SSO.PATIENTS p
  ON p.subject_id = a.subject_id
WHERE p.anchor_age >= 18;",SSO.ADMISSIONS;SSO.PATIENTS,subject_id,MIMIC-IV는 de-id를 위해 anchor_age를 사용.,,
exposure,입원 기간 동안 norepinephrine 총 투여량(amount)을 입원별로 합산해줘.,"WITH norepi_item AS (
  SELECT itemid
  FROM SSO.D_ITEMS
  WHERE LOWER(label) LIKE '%norepinephrine%'
), stays AS (
  SELECT hadm_id, stay_id
  FROM SSO.ICUSTAYS
)
SELECT
  s.hadm_id,
  SUM(ie.amount) AS norepi_total_amount
FROM stays s
JOIN SSO.INPUTEVENTS ie
  ON ie.stay_id = s.stay_id
JOIN norepi_item ni
  ON ni.itemid = ie.itemid
GROUP BY s.hadm_id;",SSO.ICUSTAYS;SSO.INPUTEVENTS;SSO.D_ITEMS,stay_id;hadm_id;itemid,"승압제는 보통 icu.inputevents에서 추출, label->itemid 매핑 필요.",13초,
exposure,입원 기간 전체에서 승압제(노르에피네프린/에피네프린/바소프레신)를 약물 종류별로 각각 총 투여량을 계산해줘.,"WITH vp_items AS (
  SELECT itemid,
         CASE
           WHEN LOWER(label) LIKE '%norepinephrine%' THEN 'norepinephrine'
           WHEN LOWER(label) LIKE '%epinephrine%' THEN 'epinephrine'
           WHEN LOWER(label) LIKE '%vasopressin%' THEN 'vasopressin'
         END AS drug
  FROM SSO.D_ITEMS
  WHERE LOWER(label) LIKE '%norepinephrine%'
     OR LOWER(label) LIKE '%epinephrine%'
     OR LOWER(label) LIKE '%vasopressin%'
), stays AS (
  SELECT hadm_id, stay_id
  FROM SSO.ICUSTAYS
)
SELECT
  s.hadm_id,
  v.drug,
  SUM(ie.amount) AS total_amount
FROM stays s
JOIN SSO.INPUTEVENTS ie
  ON ie.stay_id = s.stay_id
JOIN vp_items v
  ON v.itemid = ie.itemid
GROUP BY s.hadm_id, v.drug;",SSO.ICUSTAYS;SSO.INPUTEVENTS;SSO.D_ITEMS,stay_id;hadm_id;itemid,운영에서는 drug mapping 테이블을 별도로 두는 편이 안정적.,15초,
exposure,중환자실 입원 기간동안 norepinephrine이 언제부터 언제까지 어떤 속도로 들어갔는지(시작/종료/속도) 타임라인 형태로 보여줘.,"WITH norepi_item AS (
  SELECT itemid
  FROM SSO.D_ITEMS
  WHERE LOWER(label) LIKE '%norepinephrine%'
)
SELECT
  ie.stay_id,
  ie.starttime,
  ie.endtime,
  ie.rate,
  ie.rateuom
FROM SSO.INPUTEVENTS ie
JOIN norepi_item ni
  ON ni.itemid = ie.itemid
WHERE ie.rate IS NOT NULL
ORDER BY ie.stay_id, ie.starttime;",SSO.INPUTEVENTS;SSO.D_ITEMS,stay_id;itemid,rate 단위(rateuom) 확인 필요.,11초,
exposure,처방 기록에서 항생제 리스트 테이블 만들어줘. drug는 대문자로 통일해줘.,"WITH abx_flag AS (
  SELECT DISTINCT
    drug,
    route,
    CASE
      WHEN LOWER(drug) LIKE '%vancomycin%' THEN 1
      WHEN LOWER(drug) LIKE '%zosyn%' THEN 1
      WHEN LOWER(drug) LIKE '%ceftriaxone%' THEN 1
      ELSE 0
    END AS is_antibiotic
  FROM SSO.prescriptions
  WHERE drug_type NOT IN ('BASE')
    AND route NOT IN ('OU','OS','OD','AU','AS','AD','TP')
    AND LOWER(route) NOT LIKE '%ear%'
    AND LOWER(route) NOT LIKE '%eye%')
SELECT
  p.subject_id, p.hadm_id,
  i.stay_id,
  p.drug AS antibiotic,
  p.route,
  p.starttime,
  p.stoptime
FROM SSO.prescriptions p
JOIN abx_flag f
  ON p.drug = f.drug
 AND p.route = f.route
LEFT JOIN SSO.icustays i
  ON p.hadm_id = i.hadm_id
 AND p.starttime >= i.intime
 AND p.starttime <  i.outtime
WHERE f.is_antibiotic = 1;",,,,,
exposure,입원 중 처방(prescriptions)에서 특정 항생제(예: piperacillin-tazobactam)가 몇 번 주문됐는지 입원별로 세어줘.,"SELECT
  hadm_id,
  COUNT(*) AS rx_order_cnt
FROM SSO.PRESCRIPTIONS
WHERE LOWER(drug) LIKE '%piperacillin%tazobactam%'
GROUP BY hadm_id;",SSO.PRESCRIPTIONS,hadm_id,"prescriptions는 주문(요청) 데이터, 투여와 구분.",,
exposure,중환자실 입원중에 CRRT(지속적 신대체요법/투석) 관련 처치 이벤트가 한 번이라도 있었는지 확인해서 표시해줘.,"WITH crrt_items AS (
  SELECT itemid
  FROM SSO.D_ITEMS
  WHERE LOWER(label) LIKE '%crrt%'
     OR LOWER(label) LIKE '%dialysis%'
)
SELECT
  pe.stay_id,
  MIN(pe.starttime) AS first_crrt_time
FROM SSO.PROCEDUREEVENTS pe
JOIN crrt_items ci
  ON ci.itemid = pe.itemid
GROUP BY pe.stay_id;",SSO.PROCEDUREEVENTS;SSO.D_ITEMS,stay_id;itemid,procedureevents 기반 처치 시작 시점 추출 패턴.,,
outcome,입원별로 병원 내 사망 여부를 뽑아줘.,"SELECT
  hadm_id,
  subject_id,
  hospital_expire_flag
FROM SSO.ADMISSIONS;",SSO.ADMISSIONS,hadm_id;subject_id,입원 단위 결과 변수로 바로 사용 가능.,,
outcome,입원별 재원일수를 계산해줘.,"SELECT
  hadm_id,
  subject_id,
  admittime,
  dischtime,
  (dischtime - admittime) AS los_interval
FROM SSO.ADMISSIONS;",SSO.ADMISSIONS,hadm_id,DB별 interval 타입/표현이 다를 수 있음.,,
outcome,중환자실 입원 기간별 재실시간을 계산해줘.,"SELECT
  stay_id,
  hadm_id,
  intime,
  outtime,
  (outtime - intime) AS icu_los_interval
FROM SSO.ICUSTAYS;",SSO.ICUSTAYS,stay_id;hadm_id,ICU 단위 결과 변수.,,
outcome,각 입원에 대해 30일 내 재입원 여부를 다시 한 번(분석용 라벨로) 만들어줘.,"SELECT
  a1.hadm_id,
  a1.subject_id,
  CASE WHEN EXISTS (
    SELECT 1
    FROM SSO.ADMISSIONS a2
    WHERE a2.subject_id = a1.subject_id
      AND a2.admittime BETWEEN a1.dischtime AND a1.dischtime + 30
      AND a2.hadm_id <> a1.hadm_id
  ) THEN 1 ELSE 0 END AS readmit_30d_flag
FROM SSO.ADMISSIONS a1;",SSO.ADMISSIONS,subject_id,질 평가 지표로 자주 쓰는 derived outcome.,,
outcome,입원 중 사망한 환자는 사망 시점(deathtime)도 같이 포함해서 뽑아줘.,"SELECT
  hadm_id,
  subject_id,
  hospital_expire_flag,
  deathtime
FROM SSO.ADMISSIONS
WHERE hospital_expire_flag = 1;",SSO.ADMISSIONS,hadm_id,deathtime은 일부 입원에서만 존재.,,
outcome,퇴원 형태가 어떻게 분포하는지 집계해줘.,"SELECT
  discharge_location,
  COUNT(*) AS hadm_cnt
FROM SSO.ADMISSIONS
GROUP BY discharge_location
ORDER BY hadm_cnt DESC;",SSO.ADMISSIONS,hadm_id,퇴원 형태는 연구/운영 지표로 자주 사용.,,null은 뭘 의미하는걸까?
outcome,입원 중 병동 이동이 총 몇 번 있었는지 입원별로 계산해줘.,"SELECT
  hadm_id,
  COUNT(*) AS transfer_cnt
FROM SSO.TRANSFERS
GROUP BY hadm_id;",SSO.TRANSFERS,hadm_id,transfers는 병동/부서 이동 이벤트 테이블.,,
outcome,"같은 입원안에서 중환자실에 두 번 이상 들어간 경우(재입실, 두 번째 stay 이상)인지 플래그로 표시해줘.","WITH cnt AS (
  SELECT hadm_id, COUNT(*) AS icu_stay_cnt
  FROM SSO.ICUSTAYS
  GROUP BY hadm_id
)
SELECT
  hadm_id,
  CASE WHEN icu_stay_cnt >= 2 THEN 1 ELSE 0 END AS icu_readmit_same_hadm_flag
FROM cnt;",SSO.ICUSTAYS,hadm_id,ICU 재입실은 병원 내 경과 악화의 대리지표로 쓰이기도 함.,,
