{
  "version": "2026-02-16",
  "dialect_target": "oracle",
  "derived_variables": [
    {
      "derived_name": "sofa",
      "aliases": [
        "SOFA",
        "SOFA score",
        "Sequential Organ Failure Assessment"
      ],
      "type": "severity_score",
      "definition": "Organ dysfunction severity score for ICU patients.",
      "inputs": [
        {
          "name": "gcs",
          "signal": "gcs",
          "domain": "vital"
        },
        {
          "name": "map",
          "signal": "mean_arterial_pressure",
          "domain": "vital"
        },
        {
          "name": "vasopressors",
          "signal": "vasopressor_rates",
          "domain": "medication"
        },
        {
          "name": "pao2",
          "signal": "pao2",
          "domain": "lab"
        },
        {
          "name": "fio2",
          "signal": "fio2",
          "domain": "vital"
        },
        {
          "name": "bilirubin",
          "signal": "bilirubin_total",
          "domain": "lab"
        },
        {
          "name": "platelets",
          "signal": "platelet_count",
          "domain": "lab"
        },
        {
          "name": "creatinine",
          "signal": "creatinine",
          "domain": "lab"
        },
        {
          "name": "urine_output",
          "signal": "urine_output",
          "domain": "output"
        },
        {
          "name": "vent_status",
          "signal": "mechanical_ventilation_flag",
          "domain": "treatment"
        }
      ],
      "time_windows": [
        {
          "window_name": "hourly_over_icu_stay",
          "anchor": "icustay",
          "notes": "SOFA is typically computed hourly across ICU stay."
        },
        {
          "window_name": "rolling_24h",
          "anchor": "icustay",
          "notes": "Commonly summarized as rolling 24h maximum."
        }
      ],
      "sql_url": "https://github.com/MIT-LCP/mimic-code/blob/main/mimic-iv/concepts_postgres/score/sofa.sql",
      "sql_url_dialect": "postgres",
      "oracle_template": {
        "template_name": "score_hourly_rollup",
        "strategy": "Compute component scores in hourly bins; join components on stay_id + hour; compute total; optionally apply rolling 24h window max.",
        "requires_signal_map": true
      },
      "normalization_rules": [
        "FiO2 must be normalized to fraction (0-1) before computing P/F components.",
        "Track missingness per component; do not treat missing as normal silently unless analysis specifies."
      ],
      "sanity_checks": [
        {
          "field": "sofa_total",
          "check": "range",
          "min": 0,
          "max": 24
        }
      ]
    },
    {
      "derived_name": "sofa_first_day",
      "aliases": [
        "first-day SOFA",
        "first day sofa",
        "SOFA 24h",
        "SOFA first 24 hours"
      ],
      "type": "severity_score",
      "definition": "SOFA computed from the first 24 hours after ICU admission.",
      "inputs": [
        {
          "name": "sofa_components",
          "signal": "sofa_components",
          "domain": "derived"
        }
      ],
      "time_windows": [
        {
          "window_name": "icu_first_day",
          "anchor": "ICU.ICUSTAYS.INTIME",
          "start_offset_hours": 0,
          "end_offset_hours": 24
        }
      ],
      "sql_url": "https://github.com/MIT-LCP/mimic-iv/blob/master/concepts/firstday/first_day_sofa.sql",
      "sql_url_dialect": "generic",
      "oracle_template": {
        "template_name": "score_first_day",
        "strategy": "Restrict component extraction to intime..intime+24h; compute SOFA using same component logic; aggregate as max within window.",
        "requires_signal_map": true
      },
      "sanity_checks": [
        {
          "field": "sofa_first_day",
          "check": "range",
          "min": 0,
          "max": 24
        }
      ]
    },
    {
      "derived_name": "oasis",
      "aliases": [
        "OASIS",
        "OASIS score"
      ],
      "type": "severity_score",
      "definition": "ICU severity score using a small set of first-day features.",
      "inputs": [
        {
          "name": "age",
          "signal": "age",
          "domain": "demographic"
        },
        {
          "name": "gcs",
          "signal": "gcs",
          "domain": "vital"
        },
        {
          "name": "heart_rate",
          "signal": "heart_rate",
          "domain": "vital"
        },
        {
          "name": "mean_bp",
          "signal": "mean_arterial_pressure",
          "domain": "vital"
        },
        {
          "name": "resp_rate",
          "signal": "resp_rate",
          "domain": "vital"
        },
        {
          "name": "temperature",
          "signal": "temperature",
          "domain": "vital"
        },
        {
          "name": "urine_output",
          "signal": "urine_output",
          "domain": "output"
        },
        {
          "name": "vent_flag",
          "signal": "mechanical_ventilation_flag",
          "domain": "treatment"
        },
        {
          "name": "elective_surgery_flag",
          "signal": "elective_surgery_flag",
          "domain": "admin"
        },
        {
          "name": "pre_icu_los",
          "signal": "pre_icu_los",
          "domain": "admin"
        }
      ],
      "time_windows": [
        {
          "window_name": "icu_first_day",
          "anchor": "ICU.ICUSTAYS.INTIME",
          "start_offset_hours": 0,
          "end_offset_hours": 24
        }
      ],
      "sql_url": "https://github.com/MIT-LCP/mimic-code/blob/main/mimic-iv/concepts_postgres/score/oasis.sql",
      "sql_url_dialect": "postgres",
      "oracle_template": {
        "template_name": "score_binned_threshold",
        "strategy": "Compute first-day extrema (min/max) where needed, then apply OASIS point table (binning).",
        "requires_signal_map": true
      }
    },
    {
      "derived_name": "qsofa",
      "aliases": [
        "qSOFA"
      ],
      "type": "clinical_rule_score",
      "definition": "Quick SOFA screening score (typically RR, SBP, mental status).",
      "inputs": [
        {
          "name": "resp_rate",
          "signal": "resp_rate",
          "domain": "vital"
        },
        {
          "name": "sbp",
          "signal": "systolic_blood_pressure",
          "domain": "vital"
        },
        {
          "name": "gcs_or_mental",
          "signal": "gcs",
          "domain": "vital"
        }
      ],
      "time_windows": [
        {
          "window_name": "icu_first_day",
          "anchor": "ICU.ICUSTAYS.INTIME",
          "start_offset_hours": 0,
          "end_offset_hours": 24
        }
      ],
      "sql_url": null,
      "sql_url_dialect": null,
      "oracle_template": {
        "template_name": "rule_score_threshold_count",
        "strategy": "Score = sum( RR>=22, SBP<=100, GCS<15 ). Compute per stay (max within window) or at specific timepoint depending on study.",
        "requires_signal_map": true
      },
      "sanity_checks": [
        {
          "field": "qsofa",
          "check": "range",
          "min": 0,
          "max": 3
        }
      ]
    },
    {
      "derived_name": "sirs",
      "aliases": [
        "SIRS",
        "Systemic inflammatory response syndrome"
      ],
      "type": "clinical_rule_score",
      "definition": "SIRS criteria count based on vitals/labs (definitions vary by study).",
      "inputs": [
        {
          "name": "heart_rate",
          "signal": "heart_rate",
          "domain": "vital"
        },
        {
          "name": "resp_rate",
          "signal": "resp_rate",
          "domain": "vital"
        },
        {
          "name": "temperature",
          "signal": "temperature",
          "domain": "vital"
        },
        {
          "name": "wbc",
          "signal": "wbc",
          "domain": "lab"
        }
      ],
      "time_windows": [
        {
          "window_name": "hospital_first_day",
          "anchor": "HOSP.ADMISSIONS.ADMITTIME",
          "start_offset_hours": 0,
          "end_offset_hours": 24
        }
      ],
      "sql_url": null,
      "sql_url_dialect": null,
      "oracle_template": {
        "template_name": "rule_score_threshold_count",
        "strategy": "Score = count of criteria met; must define thresholds + simultaneous window. Store thresholds in metadata versioned per study.",
        "requires_signal_map": true
      },
      "notes": [
        "SIRS thresholds and time concurrence rules vary; treat as parameterized definition."
      ]
    },
    {
      "derived_name": "apache_ii",
      "aliases": [
        "APACHE II"
      ],
      "type": "severity_score",
      "definition": "Acute Physiology and Chronic Health Evaluation II score (complex; many components).",
      "inputs": [
        {
          "name": "physiology_components",
          "signal": "apache_ii_components",
          "domain": "derived"
        }
      ],
      "time_windows": [
        {
          "window_name": "icu_first_day",
          "anchor": "ICU.ICUSTAYS.INTIME",
          "start_offset_hours": 0,
          "end_offset_hours": 24
        }
      ],
      "sql_url": null,
      "sql_url_dialect": null,
      "oracle_template": {
        "template_name": "score_complex_components",
        "strategy": "Implement as component extraction + point table; recommend starting from a validated library or adding later.",
        "requires_signal_map": true
      },
      "notes": [
        "Not provided as official mimic-code SQL in the referenced sources; treat as future extension unless you have a validated implementation."
      ]
    },
    {
      "derived_name": "saps_ii",
      "aliases": [
        "SAPS II",
        "Simplified Acute Physiology Score II"
      ],
      "type": "severity_score",
      "definition": "Severity score computed from first-day features; requires point table.",
      "inputs": [
        {
          "name": "saps_ii_components",
          "signal": "saps_ii_components",
          "domain": "derived"
        }
      ],
      "time_windows": [
        {
          "window_name": "icu_first_day",
          "anchor": "ICU.ICUSTAYS.INTIME",
          "start_offset_hours": 0,
          "end_offset_hours": 24
        }
      ],
      "sql_url": null,
      "sql_url_dialect": null,
      "oracle_template": {
        "template_name": "score_binned_threshold",
        "strategy": "Compute extrema then apply SAPS II point table; must store bins & points as data-driven metadata.",
        "requires_signal_map": true
      }
    },
    {
      "derived_name": "news",
      "aliases": [
        "NEWS",
        "National Early Warning Score"
      ],
      "type": "early_warning_score",
      "definition": "Early warning score based on vitals and oxygen requirement (implementation varies).",
      "inputs": [
        {
          "name": "resp_rate",
          "signal": "resp_rate",
          "domain": "vital"
        },
        {
          "name": "spo2",
          "signal": "spo2",
          "domain": "vital"
        },
        {
          "name": "supplemental_o2_flag",
          "signal": "supplemental_oxygen_flag",
          "domain": "treatment"
        },
        {
          "name": "temperature",
          "signal": "temperature",
          "domain": "vital"
        },
        {
          "name": "sbp",
          "signal": "systolic_blood_pressure",
          "domain": "vital"
        },
        {
          "name": "heart_rate",
          "signal": "heart_rate",
          "domain": "vital"
        },
        {
          "name": "consciousness",
          "signal": "consciousness_scale",
          "domain": "vital"
        }
      ],
      "time_windows": [
        {
          "window_name": "any_window",
          "anchor": "time_series"
        }
      ],
      "sql_url": null,
      "sql_url_dialect": null,
      "oracle_template": {
        "template_name": "score_point_table",
        "strategy": "Implement NEWS as points-by-bins; store point table in metadata for reproducibility.",
        "requires_signal_map": true
      }
    },
    {
      "derived_name": "mews",
      "aliases": [
        "MEWS",
        "Modified Early Warning Score"
      ],
      "type": "early_warning_score",
      "definition": "Early warning score based on vitals (implementation varies).",
      "inputs": [
        {
          "name": "resp_rate",
          "signal": "resp_rate",
          "domain": "vital"
        },
        {
          "name": "heart_rate",
          "signal": "heart_rate",
          "domain": "vital"
        },
        {
          "name": "sbp",
          "signal": "systolic_blood_pressure",
          "domain": "vital"
        },
        {
          "name": "temperature",
          "signal": "temperature",
          "domain": "vital"
        },
        {
          "name": "consciousness",
          "signal": "consciousness_scale",
          "domain": "vital"
        }
      ],
      "time_windows": [
        {
          "window_name": "any_window",
          "anchor": "time_series"
        }
      ],
      "sql_url": null,
      "sql_url_dialect": null,
      "oracle_template": {
        "template_name": "score_point_table",
        "strategy": "Implement MEWS as points-by-bins; store point table in metadata.",
        "requires_signal_map": true
      }
    },
    {
      "derived_name": "rox_index",
      "aliases": [
        "ROX",
        "ROX index"
      ],
      "type": "respiratory_index",
      "definition": "ROX = (SpO2 / FiO2) / RR.",
      "inputs": [
        {
          "name": "spo2",
          "signal": "spo2",
          "domain": "vital"
        },
        {
          "name": "fio2",
          "signal": "fio2",
          "domain": "vital"
        },
        {
          "name": "resp_rate",
          "signal": "resp_rate",
          "domain": "vital"
        }
      ],
      "time_windows": [
        {
          "window_name": "any_window",
          "anchor": "time_series"
        },
        {
          "window_name": "icu_discharge_minus_24h_to_discharge",
          "anchor": "ICU.ICUSTAYS.OUTTIME",
          "start_offset_hours": -24,
          "end_offset_hours": 0
        }
      ],
      "sql_url": null,
      "sql_url_dialect": null,
      "oracle_template": {
        "template_name": "ratio_index_timeseries",
        "strategy": "At each charttime (or hourly bin), compute FiO2 fraction normalization, then ROX=(spo2/fio2)/rr. Aggregate as last/mean in window if needed.",
        "requires_signal_map": true
      },
      "normalization_rules": [
        "FiO2 normalization: if FiO2>1 and <=100, divide by 100; else if between 0 and 1, keep; otherwise set NULL.",
        "SpO2 must be 0-100; RR must be >0."
      ]
    },
    {
      "derived_name": "pf_ratio",
      "aliases": [
        "P/F",
        "PaO2/FiO2",
        "P/F ratio"
      ],
      "type": "respiratory_index",
      "definition": "PaO2/FiO2 ratio.",
      "inputs": [
        {
          "name": "pao2",
          "signal": "pao2",
          "domain": "lab"
        },
        {
          "name": "fio2",
          "signal": "fio2",
          "domain": "vital"
        }
      ],
      "time_windows": [
        {
          "window_name": "any_window",
          "anchor": "time_series"
        }
      ],
      "sql_url": null,
      "sql_url_dialect": null,
      "oracle_template": {
        "template_name": "ratio_index_timeseries",
        "strategy": "Join PaO2 lab with nearest FiO2 within tolerance or bin hourly; compute pao2_mmHg / fio2_fraction.",
        "requires_signal_map": true
      },
      "normalization_rules": [
        "PaO2 unit must be mmHg; FiO2 normalized to fraction (0-1)."
      ]
    },
    {
      "derived_name": "egfr",
      "aliases": [
        "eGFR",
        "estimated GFR"
      ],
      "type": "renal_function_index",
      "definition": "Estimated glomerular filtration rate using creatinine and demographics (formula must be specified).",
      "inputs": [
        {
          "name": "creatinine",
          "signal": "creatinine",
          "domain": "lab"
        },
        {
          "name": "age",
          "signal": "age",
          "domain": "demographic"
        },
        {
          "name": "sex",
          "signal": "sex",
          "domain": "demographic"
        }
      ],
      "time_windows": [
        {
          "window_name": "any_window",
          "anchor": "time_series"
        }
      ],
      "sql_url": null,
      "sql_url_dialect": null,
      "oracle_template": {
        "template_name": "formula_scalar",
        "strategy": "Pick formula version (CKD-EPI 2009/2021). Store coefficients and unit conversions in metadata; compute per lab draw.",
        "requires_signal_map": true
      },
      "notes": [
        "Must specify the exact eGFR equation version and units; otherwise results are not comparable."
      ]
    },
    {
      "derived_name": "bmi",
      "aliases": [
        "BMI",
        "body mass index"
      ],
      "type": "anthropometric_index",
      "definition": "BMI = weight_kg / (height_m^2).",
      "inputs": [
        {
          "name": "weight",
          "signal": "weight",
          "domain": "vital"
        },
        {
          "name": "height",
          "signal": "height",
          "domain": "vital"
        }
      ],
      "time_windows": [
        {
          "window_name": "any_window",
          "anchor": "time_series"
        }
      ],
      "sql_url": null,
      "sql_url_dialect": null,
      "oracle_template": {
        "template_name": "formula_scalar",
        "strategy": "Normalize weight to kg and height to meters; pick first-day or nearest measurement depending on study.",
        "requires_signal_map": true
      },
      "normalization_rules": [
        "Convert height cm->m; inches->m; weight lb->kg."
      ]
    },
    {
      "derived_name": "shock_index",
      "aliases": [
        "Shock Index"
      ],
      "type": "hemodynamic_index",
      "definition": "Shock index = heart_rate / systolic_blood_pressure.",
      "inputs": [
        {
          "name": "heart_rate",
          "signal": "heart_rate",
          "domain": "vital"
        },
        {
          "name": "sbp",
          "signal": "systolic_blood_pressure",
          "domain": "vital"
        }
      ],
      "time_windows": [
        {
          "window_name": "any_window",
          "anchor": "time_series"
        }
      ],
      "sql_url": null,
      "sql_url_dialect": null,
      "oracle_template": {
        "template_name": "ratio_index_timeseries",
        "strategy": "Compute per time bin or nearest-pair join; exclude SBP<=0; aggregate as max/mean if needed.",
        "requires_signal_map": true
      }
    },
    {
      "derived_name": "lactate_clearance",
      "aliases": [
        "Lactate clearance",
        "lactate delta",
        "lactate change"
      ],
      "type": "trend_metric",
      "definition": "Change in lactate between two times (definition varies: absolute, relative, or percent).",
      "inputs": [
        {
          "name": "lactate",
          "signal": "lactate",
          "domain": "lab"
        }
      ],
      "time_windows": [
        {
          "window_name": "two_timepoints",
          "anchor": "admission_or_icu",
          "parameters": [
            "t0_hours",
            "t1_hours"
          ]
        }
      ],
      "sql_url": null,
      "sql_url_dialect": null,
      "oracle_template": {
        "template_name": "delta_two_timepoints",
        "strategy": "Define t0 and t1 relative to admission/icu intime; select nearest lactate values; compute delta or percent change.",
        "requires_signal_map": true
      },
      "notes": [
        "Must store exact t0/t1 selection rule (first value in window vs nearest) to ensure reproducibility."
      ]
    }
  ],
  "oracle_conversion_templates": [
    {
      "template_name": "icu_first_day_window",
      "description": "Standard ICU first-day time window filter.",
      "oracle_sql_snippet": "e.charttime BETWEEN icu.intime AND icu.intime + INTERVAL '24' HOUR"
    },
    {
      "template_name": "icu_discharge_minus_24h_window",
      "description": "Standard ICU discharge -24h to discharge filter.",
      "oracle_sql_snippet": "e.charttime BETWEEN icu.outtime - INTERVAL '24' HOUR AND icu.outtime"
    },
    {
      "template_name": "fio2_normalize_fraction",
      "description": "Normalize FiO2 to fraction (0-1) from either fraction or percent.",
      "oracle_sql_snippet": "CASE WHEN fio2_val IS NULL THEN NULL WHEN fio2_val > 1 AND fio2_val <= 100 THEN fio2_val/100 WHEN fio2_val > 0 AND fio2_val <= 1 THEN fio2_val ELSE NULL END"
    },
    {
      "template_name": "exists_measurement_in_window",
      "description": "Generic 'must exist' measurement rule to avoid valuenum-only missingness bugs.",
      "oracle_sql_snippet": "EXISTS (SELECT 1 FROM {event_table} e WHERE e.{link_col} = {link_val} AND e.{time_col} BETWEEN {t0} AND {t1} AND e.{item_col} IN ({itemid_list}) AND (e.{num_col} IS NOT NULL OR e.{text_col} IS NOT NULL))"
    }
  ],
  "notes": [
    "sql_url is not mandatory. Use it when a validated reference implementation exists (e.g., mimic-code SOFA/OASIS).",
    "For indices without a canonical SQL, store formula + normalization + window rules; then generate Oracle SQL via templates using your signal_map/itemid codesets."
  ]
}