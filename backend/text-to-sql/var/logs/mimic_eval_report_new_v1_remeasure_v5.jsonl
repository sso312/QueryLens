{"idx": 1, "question": "Transfer counts by care unit", "expected_sql": "SELECT * FROM ( SELECT CAREUNIT, COUNT(*) AS cnt FROM TRANSFERS WHERE CAREUNIT IS NOT NULL GROUP BY CAREUNIT ORDER BY cnt DESC ) WHERE ROWNUM <= 10", "generated_sql_initial": "SELECT * FROM ( SELECT CAREUNIT, COUNT(*) AS cnt FROM TRANSFERS WHERE CAREUNIT IS NOT NULL GROUP BY CAREUNIT ORDER BY cnt DESC ) WHERE ROWNUM <= 10", "generated_sql": "SELECT * FROM ( SELECT CAREUNIT, COUNT(*) AS cnt FROM TRANSFERS WHERE CAREUNIT IS NOT NULL GROUP BY CAREUNIT ORDER BY cnt DESC ) WHERE ROWNUM <= 10", "expected_error": null, "generated_error": null, "execution_mode": "service_pipeline", "repair_attempts": 0, "status": "match", "compare": {"same_cols": true, "same_rows": true, "alias_equivalent": true, "subset_rows": false, "expected_row_count": 10, "generated_row_count": 10}}
{"idx": 2, "question": "\uc785\uc6d0\ubcc4\ub85c \ubcd1\uc6d0 \ub0b4 \uc0ac\ub9dd \uc5ec\ubd80\ub97c \ubf51\uc544\uc918.", "status": "oneshot_error", "error": "WHERE clause required"}
{"idx": 3, "question": "\uc9c4\ub2e8 \ucf54\ub4dc\uac00 \uc5b4\ub5a4 \uccb4\uacc4(\ubc84\uc804)\ub85c \uae30\ub85d\ub410\ub294\uc9c0(\uc608: ICD-9/ICD-10) \ube44\uc911\uc744 \uc54c\ub824\uc918.", "status": "oneshot_error", "error": "WHERE clause required"}
{"idx": 4, "question": "\uc785\uc6d0 \uc911 \ucc98\ubc29(prescriptions)\uc5d0\uc11c \ud2b9\uc815 \ud56d\uc0dd\uc81c(\uc608: piperacillin-tazobactam)\uac00 \uba87 \ubc88 \uc8fc\ubb38\ub410\ub294\uc9c0 \uc785\uc6d0\ubcc4\ub85c \uc138\uc5b4\uc918.", "expected_sql": "SELECT hadm_id, COUNT(*) AS rx_order_cnt FROM PRESCRIPTIONS WHERE LOWER(drug) LIKE '%piperacillin%tazobactam%' GROUP BY hadm_id", "generated_sql_initial": "SELECT HADM_ID, COUNT(*) AS CNT FROM PRESCRIPTIONS WHERE LOWER(drug) LIKE '%piperacillin%tazobactam%' GROUP BY HADM_ID", "generated_sql": "SELECT HADM_ID, COUNT(*) AS CNT FROM PRESCRIPTIONS WHERE LOWER(drug) LIKE '%piperacillin%tazobactam%' GROUP BY HADM_ID", "expected_error": null, "generated_error": null, "execution_mode": "service_pipeline", "repair_attempts": 1, "status": "match", "compare": {"same_cols": true, "same_rows": true, "alias_equivalent": true, "subset_rows": false, "expected_row_count": 5000, "generated_row_count": 5000}}
{"idx": 5, "question": "Show yearly counts of hemodialysis catheter insertion events.", "expected_sql": "WITH hd_cath_events AS ( SELECT p.SUBJECT_ID, p.HADM_ID, p.STAY_ID, p.STARTTIME, p.ITEMID, di.LABEL FROM PROCEDUREEVENTS p JOIN D_ITEMS di ON p.ITEMID = di.ITEMID WHERE p.STARTTIME IS NOT NULL AND (((UPPER(di.LABEL) LIKE '%DIALYSIS%' AND UPPER(di.LABEL) LIKE '%CATH%') OR (UPPER(di.LABEL) LIKE '%HD%' AND UPPER(di.LABEL) LIKE '%CATH%') OR UPPER(di.LABEL) LIKE '%HEMODIALYSIS%') AND (UPPER(di.LABEL) LIKE '%INSERT%' OR UPPER(di.LABEL) LIKE '%PLAC%' OR UPPER(di.LABEL) LIKE '%INTRODUC%' OR UPPER(di.LABEL) LIKE '%NEW%' OR UPPER(di.LABEL) LIKE '%START%' OR UPPER(di.LABEL) LIKE '%CATHETER%') AND UPPER(di.LABEL) NOT LIKE '%PERITONEAL%' AND UPPER(di.LABEL) NOT LIKE '%AV FISTULA%' AND UPPER(di.LABEL) NOT LIKE '%GRAFT%') ), hd_cath_dedup AS ( SELECT DISTINCT SUBJECT_ID, HADM_ID, STAY_ID, ITEMID, STARTTIME FROM hd_cath_events ) SELECT EXTRACT(YEAR FROM a.ADMITTIME) AS ADMIT_YEAR, COUNT(*) AS N_HD_CATH_INSERT_EVENTS FROM hd_cath_dedup e JOIN ADMISSIONS a ON e.HADM_ID = a.HADM_ID GROUP BY EXTRACT(YEAR FROM a.ADMITTIME) ORDER BY ADMIT_YEAR", "generated_sql_initial": "WITH hd_cath_events AS ( SELECT p.SUBJECT_ID, p.HADM_ID, p.STAY_ID, p.STARTTIME, p.ITEMID, di.LABEL FROM PROCEDUREEVENTS p JOIN D_ITEMS di ON p.ITEMID = di.ITEMID WHERE p.STARTTIME IS NOT NULL AND (((UPPER(di.LABEL) LIKE '%DIALYSIS%' AND UPPER(di.LABEL) LIKE '%CATH%') OR (UPPER(di.LABEL) LIKE '%HD%' AND UPPER(di.LABEL) LIKE '%CATH%') OR UPPER(di.LABEL) LIKE '%HEMODIALYSIS%') AND (UPPER(di.LABEL) LIKE '%INSERT%' OR UPPER(di.LABEL) LIKE '%PLAC%' OR UPPER(di.LABEL) LIKE '%INTRODUC%' OR UPPER(di.LABEL) LIKE '%NEW%' OR UPPER(di.LABEL) LIKE '%START%' OR UPPER(di.LABEL) LIKE '%CATHETER%') AND UPPER(di.LABEL) NOT LIKE '%PERITONEAL%' AND UPPER(di.LABEL) NOT LIKE '%AV FISTULA%' AND UPPER(di.LABEL) NOT LIKE '%GRAFT%') ), hd_cath_dedup AS ( SELECT DISTINCT SUBJECT_ID, HADM_ID, STAY_ID, ITEMID, STARTTIME FROM hd_cath_events ) SELECT EXTRACT(YEAR FROM a.ADMITTIME) AS ADMIT_YEAR, COUNT(*) AS CNT FROM hd_cath_dedup e JOIN ADMISSIONS a ON e.HADM_ID = a.HADM_ID GROUP BY EXTRACT(YEAR FROM a.ADMITTIME) ORDER BY ADMIT_YEAR", "generated_sql": "WITH hd_cath_events AS ( SELECT p.SUBJECT_ID, p.HADM_ID, p.STAY_ID, p.STARTTIME, p.ITEMID, di.LABEL FROM PROCEDUREEVENTS p JOIN D_ITEMS di ON p.ITEMID = di.ITEMID WHERE p.STARTTIME IS NOT NULL AND (((UPPER(di.LABEL) LIKE '%DIALYSIS%' AND UPPER(di.LABEL) LIKE '%CATH%') OR (UPPER(di.LABEL) LIKE '%HD%' AND UPPER(di.LABEL) LIKE '%CATH%') OR UPPER(di.LABEL) LIKE '%HEMODIALYSIS%') AND (UPPER(di.LABEL) LIKE '%INSERT%' OR UPPER(di.LABEL) LIKE '%PLAC%' OR UPPER(di.LABEL) LIKE '%INTRODUC%' OR UPPER(di.LABEL) LIKE '%NEW%' OR UPPER(di.LABEL) LIKE '%START%' OR UPPER(di.LABEL) LIKE '%CATHETER%') AND UPPER(di.LABEL) NOT LIKE '%PERITONEAL%' AND UPPER(di.LABEL) NOT LIKE '%AV FISTULA%' AND UPPER(di.LABEL) NOT LIKE '%GRAFT%') ), hd_cath_dedup AS ( SELECT DISTINCT SUBJECT_ID, HADM_ID, STAY_ID, ITEMID, STARTTIME FROM hd_cath_events ) SELECT EXTRACT(YEAR FROM a.ADMITTIME) AS ADMIT_YEAR, COUNT(*) AS CNT FROM hd_cath_dedup e JOIN ADMISSIONS a ON e.HADM_ID = a.HADM_ID GROUP BY EXTRACT(YEAR FROM a.ADMITTIME) ORDER BY ADMIT_YEAR", "expected_error": null, "generated_error": null, "execution_mode": "service_pipeline", "repair_attempts": 1, "status": "match", "compare": {"same_cols": true, "same_rows": true, "alias_equivalent": true, "subset_rows": false, "expected_row_count": 40, "generated_row_count": 40}}
{"idx": 6, "question": "\uc785\uc6d0 \uc911 \ub178\ub974\uc5d0\ud53c\ub124\ud504\ub9b0 \ucc98\ubc29\uc774 \uc788\uc5c8\ub358 \uc785\uc6d0\uc774 \uba87 \uac74\uc778\uc9c0 \uc54c\ub824\uc918.", "expected_sql": "SELECT COUNT(DISTINCT p.hadm_id) AS hadm_cnt FROM PRESCRIPTIONS p JOIN ADMISSIONS a ON a.hadm_id = p.hadm_id WHERE LOWER(p.drug) LIKE '%norepinephrine%'", "generated_sql_initial": "SELECT COUNT(DISTINCT a.HADM_ID) AS CNT FROM ADMISSIONS a WHERE EXISTS (SELECT 1 FROM PRESCRIPTIONS p WHERE p.HADM_ID = a.HADM_ID AND LOWER(p.drug) LIKE '%norepinephrine%')", "generated_sql": "SELECT COUNT(DISTINCT a.HADM_ID) AS CNT FROM ADMISSIONS a WHERE EXISTS (SELECT 1 FROM PRESCRIPTIONS p WHERE p.HADM_ID = a.HADM_ID AND LOWER(p.drug) LIKE '%norepinephrine%') AND A.HADM_ID IS NOT NULL", "expected_error": null, "generated_error": null, "execution_mode": "service_pipeline", "repair_attempts": 1, "status": "match", "compare": {"same_cols": true, "same_rows": true, "alias_equivalent": true, "subset_rows": false, "expected_row_count": 1, "generated_row_count": 1}}
{"idx": 7, "question": "I have an 86-year-old man. Among males 81-91, what's the SD of distinct ECG/telemetry procedure codes per patient during hospitalization?", "expected_sql": "SELECT ROUND(STDDEV(procedure_count), 2) AS stddev_ecg_telemetry_procedures FROM ( SELECT p.subject_id, COUNT(DISTINCT pr.icd_code) AS procedure_count FROM PATIENTS p JOIN PROCEDURES_ICD pr ON p.subject_id = pr.subject_id WHERE p.gender = 'M' AND p.anchor_age BETWEEN 81 AND 91 AND pr.icd_code IS NOT NULL AND pr.icd_version IS NOT NULL AND ( (pr.icd_version = 9 AND ( pr.icd_code = '89.52' OR pr.icd_code = '89.54' )) OR (pr.icd_version = 10 AND ( pr.icd_code LIKE '4A02%' OR pr.icd_code LIKE '4A12%' )) ) GROUP BY p.subject_id ) patient_procedures;", "generated_sql_initial": "SELECT ROUND(STDDEV(procedure_count), 2) AS stddev_ecg_telemetry_procedures FROM ( SELECT p.SUBJECT_ID, COUNT(DISTINCT pr.icd_code) AS CNT FROM PATIENTS p JOIN PROCEDURES_ICD pr ON p.SUBJECT_ID = pr.SUBJECT_ID WHERE p.gender = 'M' AND p.anchor_age BETWEEN 81 AND 91 AND pr.icd_code IS NOT NULL AND pr.icd_version IS NOT NULL AND ( (pr.icd_version = 9 AND ( pr.icd_code = '89.52' OR pr.icd_code = '89.54' )) OR (pr.icd_version = 10 AND ( pr.icd_code LIKE '4A02%' OR pr.icd_code LIKE '4A12%' )) ) GROUP BY p.SUBJECT_ID ) patient_procedures;", "generated_sql": "SELECT ROUND(STDDEV(cnt), 2) AS stddev_ecg_telemetry_procedures FROM ( SELECT p.SUBJECT_ID, COUNT(DISTINCT pr.icd_code) AS cnt FROM PATIENTS p JOIN PROCEDURES_ICD pr ON p.SUBJECT_ID = pr.SUBJECT_ID WHERE p.gender = 'M' AND p.anchor_age BETWEEN 81 AND 91 AND pr.icd_code IS NOT NULL AND pr.icd_version IS NOT NULL AND ( (pr.icd_version = 9 AND ( pr.icd_code = '89.52' OR pr.icd_code = '89.54' )) OR (pr.icd_version = 10 AND ( pr.icd_code LIKE '4A02%' OR pr.icd_code LIKE '4A12%' )) ) GROUP BY p.SUBJECT_ID ) patient_procedures;", "expected_error": null, "generated_error": null, "execution_mode": "service_pipeline", "repair_attempts": 2, "status": "match", "compare": {"same_cols": true, "same_rows": true, "alias_equivalent": true, "subset_rows": false, "expected_row_count": 1, "generated_row_count": 1}}
{"idx": 8, "question": "\uc785\uc6d0 \uc911\uc5d0 \ub0b4\uacfc\ub97c \uac70\uce5c \uc785\uc6d0\uc774 \ucd1d \uba87 \uac74\uc778\uc9c0 \uc54c\ub824\uc918.", "expected_sql": "SELECT COUNT(DISTINCT s.hadm_id) AS hadm_cnt FROM SERVICES s JOIN ADMISSIONS a ON a.hadm_id = s.hadm_id WHERE s.curr_service = 'MED'", "generated_sql_initial": "SELECT COUNT(DISTINCT HADM_ID) AS CNT FROM SERVICES WHERE CURR_SERVICE = 'MED'", "generated_sql": "SELECT COUNT(DISTINCT HADM_ID) AS CNT FROM SERVICES WHERE CURR_SERVICE = 'MED'", "expected_error": null, "generated_error": null, "execution_mode": "service_pipeline", "repair_attempts": 1, "status": "mismatch", "compare": {"same_cols": true, "same_rows": false, "alias_equivalent": false, "subset_rows": false, "expected_row_count": 1, "generated_row_count": 1}}
{"idx": 9, "question": "\ud478\ub85c\uc138\ubbf8\ub4dc \uc0ac\uc6a9\ub7c9 \uc0ac\ubd84\uc704\uc218(Q1-Q4)\ubcc4 \ubcd1\uc6d0 \uc0ac\ub9dd\ub960\uc744 \ube44\uad50\ud574\uc918.", "expected_sql": "WITH drug_rx AS ( SELECT p.hadm_id, SUM(NVL(p.doses_per_24_hrs, 0)) AS dose_amt FROM PRESCRIPTIONS p WHERE p.hadm_id IS NOT NULL AND LOWER(p.drug) LIKE '%furosemide%' GROUP BY p.hadm_id ), dose_q AS ( SELECT hadm_id, dose_amt, NTILE(4) OVER (ORDER BY dose_amt) AS qtile FROM drug_rx ), adm AS ( SELECT hadm_id, hospital_expire_flag FROM ADMISSIONS WHERE hadm_id IS NOT NULL ) SELECT 'Q' || q.qtile AS dose_quartile, COUNT(DISTINCT q.hadm_id) AS n_hadm, COUNT(DISTINCT CASE WHEN a.hospital_expire_flag = 1 THEN q.hadm_id END) AS n_death_hadm, ROUND(100 * COUNT(DISTINCT CASE WHEN a.hospital_expire_flag = 1 THEN q.hadm_id END) / NULLIF(COUNT(DISTINCT q.hadm_id), 0), 2) AS hospital_mortality_rate_pct FROM dose_q q JOIN adm a ON a.hadm_id = q.hadm_id GROUP BY q.qtile ORDER BY q.qtile", "generated_sql_initial": "WITH furosemide_usage AS ( SELECT p.HADM_ID, SUM(NVL(p.doses_per_24_hrs, 0)) AS total_dose FROM PRESCRIPTIONS p WHERE LOWER(p.drug) LIKE '%furosemide%' AND p.HADM_ID IS NOT NULL GROUP BY p.HADM_ID ), dose_quartiles AS ( SELECT HADM_ID, total_dose, NTILE(4) OVER (ORDER BY total_dose) AS quartile FROM furosemide_usage ) SELECT 'Q' || d.quartile AS dose_quartile, COUNT(DISTINCT d.HADM_ID) AS n_hadm, COUNT(DISTINCT CASE WHEN a.HOSPITAL_EXPIRE_FLAG = 1 THEN d.HADM_ID END) AS n_deaths, ROUND(100 * COUNT(DISTINCT CASE WHEN a.HOSPITAL_EXPIRE_FLAG = 1 THEN d.HADM_ID END) / NULLIF(COUNT(DISTINCT d.HADM_ID), 0), 2) AS mortality_rate_pct FROM dose_quartiles d JOIN ADMISSIONS a ON a.HADM_ID = d.HADM_ID GROUP BY d.quartile ORDER BY d.quartile", "generated_sql": "WITH furosemide_usage AS ( SELECT p.HADM_ID, SUM(NVL(p.doses_per_24_hrs, 0)) AS total_dose FROM PRESCRIPTIONS p WHERE LOWER(p.drug) LIKE '%furosemide%' AND p.HADM_ID IS NOT NULL GROUP BY p.HADM_ID ), dose_quartiles AS ( SELECT HADM_ID, total_dose, NTILE(4) OVER (ORDER BY total_dose) AS quartile FROM furosemide_usage ) SELECT 'Q' || d.quartile AS dose_quartile, COUNT(DISTINCT d.HADM_ID) AS n_hadm, COUNT(DISTINCT CASE WHEN a.HOSPITAL_EXPIRE_FLAG = 1 THEN d.HADM_ID END) AS n_deaths, ROUND(100 * COUNT(DISTINCT CASE WHEN a.HOSPITAL_EXPIRE_FLAG = 1 THEN d.HADM_ID END) / NULLIF(COUNT(DISTINCT d.HADM_ID), 0), 2) AS mortality_rate_pct FROM dose_quartiles d JOIN ADMISSIONS a ON a.HADM_ID = d.HADM_ID GROUP BY d.quartile ORDER BY d.quartile", "expected_error": null, "generated_error": null, "execution_mode": "service_pipeline", "repair_attempts": 1, "status": "match", "compare": {"same_cols": true, "same_rows": true, "alias_equivalent": true, "subset_rows": false, "expected_row_count": 4, "generated_row_count": 4}}
{"idx": 10, "question": "I have a 46-year-old female. Among females 41-51, what is the standard deviation of distinct CABG procedures per patient?", "expected_sql": "SELECT ROUND(STDDEV(procedure_count), 2) as stddev_cabg_procedures FROM ( SELECT p.subject_id, COUNT(DISTINCT pr.icd_code) as procedure_count FROM PATIENTS p JOIN PROCEDURES_ICD pr ON p.subject_id = pr.subject_id WHERE p.gender = 'F' AND p.anchor_age BETWEEN 41 AND 51 AND ( (pr.icd_version = 9 AND pr.icd_code LIKE '36.1%') OR (pr.icd_version = 10 AND pr.icd_code LIKE '021%') ) GROUP BY p.subject_id ) patient_procedures;", "generated_sql_initial": "SELECT ROUND(STDDEV(procedure_count), 2) AS stddev_cabg_procedures FROM ( SELECT di.SUBJECT_ID, COUNT(DISTINCT di.icd_code) AS CNT FROM DIAGNOSES_ICD di JOIN ADMISSIONS a ON di.SUBJECT_ID = a.SUBJECT_ID WHERE a.SUBJECT_ID IN (SELECT SUBJECT_ID FROM ADMISSIONS WHERE EXTRACT(YEAR FROM ADMITTIME) - EXTRACT(YEAR FROM ANCHOR_AGE) BETWEEN 41 AND 51 AND GENDER = 'F') AND ((di.icd_version = 9 AND di.icd_code LIKE '36.1%') OR (di.icd_version = 10 AND di.icd_code LIKE '021%')) GROUP BY di.SUBJECT_ID )", "generated_sql": "SELECT ROUND(STDDEV(procedure_count), 2) AS stddev_cabg_procedures FROM ( SELECT di.SUBJECT_ID, COUNT(DISTINCT di.icd_code) AS CNT FROM DIAGNOSES_ICD di JOIN ADMISSIONS a ON di.SUBJECT_ID = a.SUBJECT_ID WHERE a.SUBJECT_ID IN (SELECT SUBJECT_ID FROM ADMISSIONS WHERE EXTRACT(YEAR FROM ADMITTIME) - EXTRACT(YEAR FROM ANCHOR_AGE) BETWEEN 41 AND 51 AND GENDER = 'F') AND ((di.icd_version = 9 AND di.icd_code LIKE '36.1%') OR (di.icd_version = 10 AND di.icd_code LIKE '021%')) GROUP BY di.SUBJECT_ID )", "expected_error": null, "generated_error": "ORA-00904: \"PROCEDURE_COUNT\": invalid identifier\nHelp: https://docs.oracle.com/error-help/db/ora-00904/", "execution_mode": "service_pipeline", "repair_attempts": 0, "status": "exec_error"}
