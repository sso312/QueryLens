{"idx": 1, "question": "loop diuretics(예: furosemide) 사용량 사분위수(Q1-Q4)에 따른 AKI 진단 비율을 비교해줘. 전체 기간 / 전체 환자", "bucket": 4, "sql": "WITH loop_rx AS ( \n    SELECT p.HADM_ID, SUM(NVL(p.doses_per_24_hrs, 0)) AS loop_dose \n    FROM PRESCRIPTIONS p \n    WHERE ROWNUM <= 5000 AND p.HADM_ID IS NOT NULL \n    AND (LOWER(p.drug) LIKE '%furosemide%' OR LOWER(p.drug) LIKE '%bumetanide%' OR LOWER(p.drug) LIKE '%torsemide%' OR LOWER(p.drug) LIKE '%ethacrynic%' OR LOWER(p.drug) LIKE '%loop diuretic%') \n    GROUP BY p.HADM_ID \n), \n     dose_q AS ( \n    SELECT HADM_ID, loop_dose, NTILE(4) OVER (ORDER BY loop_dose) AS qtile \n    FROM loop_rx \n), \n     aki_hadm AS ( \n    SELECT DISTINCT d.HADM_ID \n    FROM DIAGNOSES_ICD d \n    WHERE (d.icd_version = 10 AND d.icd_code LIKE 'N17%') \n    OR (d.icd_version = 9 AND d.icd_code LIKE '584%') \n) \nSELECT 'Q' || q.qtile AS dose_quartile, \n       COUNT(DISTINCT q.HADM_ID) AS n_hadm, \n       COUNT(DISTINCT CASE WHEN a.HADM_ID IS NOT NULL THEN q.HADM_ID END) AS n_aki_hadm, \n       ROUND(100 * COUNT(DISTINCT CASE WHEN a.HADM_ID IS NOT NULL THEN q.HADM_ID END) / NULLIF(COUNT(DISTINCT q.HADM_ID), 0), 2) AS aki_diagnosis_rate_pct \nFROM dose_q q \nLEFT JOIN aki_hadm a ON a.HADM_ID = q.HADM_ID \nGROUP BY q.qtile \nORDER BY q.qtile", "checks": {"has_ntile": true, "has_group_by": true, "not_single_overall": true, "has_quantitative_usage": true, "has_med_source": true, "has_bucket_label": true, "has_aki_filter": true, "exec_ok": true, "row_count_positive": true}, "pass_core": true, "row_count": 4, "exec_err": null, "postprocess": ["column:hadm_id->HADM_ID", "rownum_cap_5000"], "risk": 0.9583227007023968}
{"idx": 2, "question": "푸로세미드 사용량 사분위수(Q1-Q4)별 병원 사망률을 비교해줘. 전체 기간 / 전체 환자", "bucket": 4, "sql": "SELECT mortality_bucket, COUNT(*) AS num_admissions, AVG(HOSPITAL_EXPIRE_FLAG) AS mortality_rate FROM ( SELECT a.HADM_ID, a.HOSPITAL_EXPIRE_FLAG, NTILE(4) OVER (ORDER BY SUM(i.amount) DESC) AS mortality_bucket FROM admissions a JOIN INPUTEVENTS i ON a.HADM_ID = i.HADM_ID WHERE ROWNUM <= 5000 GROUP BY a.HADM_ID, a.HOSPITAL_EXPIRE_FLAG ) GROUP BY mortality_bucket ORDER BY mortality_bucket", "checks": {"has_ntile": true, "has_group_by": true, "not_single_overall": true, "has_quantitative_usage": true, "has_med_source": true, "has_bucket_label": false, "has_aki_filter": true, "exec_ok": true, "row_count_positive": true}, "pass_core": true, "row_count": 4, "exec_err": null, "postprocess": ["table:inputevents->INPUTEVENTS", "column:hospital_expire_flag->HOSPITAL_EXPIRE_FLAG", "column:hadm_id->HADM_ID", "rownum_cap_5000"], "risk": 0.346}
{"idx": 3, "question": "bumetanide 사용량 사분위수(Q1-Q4)에 따른 AKI 진단 비율을 비교해줘. 전체 기간 / 전체 환자", "bucket": 4, "sql": "WITH bumetanide_usage AS ( \n    SELECT i.HADM_ID, SUM(i.AMOUNT) AS total_bumetanide \n    FROM INPUTEVENTS i \n    JOIN D_ITEMS d ON i.ITEMID = d.ITEMID \n    WHERE ROWNUM <= 5000 AND LOWER(d.LABEL) LIKE '%bumetanide%' \n    GROUP BY i.HADM_ID \n), usage_quartiles AS ( \n    SELECT HADM_ID, total_bumetanide, NTILE(4) OVER (ORDER BY total_bumetanide) AS quartile \n    FROM bumetanide_usage \n), aki_diagnosis AS ( \n    SELECT DISTINCT HADM_ID \n    FROM DIAGNOSES_ICD \n    WHERE (ICD_CODE LIKE 'N17%' AND ICD_VERSION = 10) OR (ICD_CODE LIKE '584%' AND ICD_VERSION = 9) \n) \nSELECT 'Q' || q.quartile AS dose_quartile, \n       COUNT(DISTINCT q.HADM_ID) AS n_hadm, \n       COUNT(DISTINCT CASE WHEN a.HADM_ID IS NOT NULL THEN q.HADM_ID END) AS n_aki_hadm, \n       ROUND(100 * COUNT(DISTINCT CASE WHEN a.HADM_ID IS NOT NULL THEN q.HADM_ID END) / NULLIF(COUNT(DISTINCT q.HADM_ID), 0), 2) AS aki_diagnosis_rate_pct \nFROM usage_quartiles q \nLEFT JOIN aki_diagnosis a ON a.HADM_ID = q.HADM_ID \nGROUP BY q.quartile \nORDER BY q.quartile", "checks": {"has_ntile": true, "has_group_by": true, "not_single_overall": true, "has_quantitative_usage": true, "has_med_source": true, "has_bucket_label": true, "has_aki_filter": true, "exec_ok": true, "row_count_positive": true}, "pass_core": true, "row_count": 4, "exec_err": null, "postprocess": ["table:d_items->D_ITEMS", "table:inputevents->INPUTEVENTS", "column:hadm_id->HADM_ID", "rownum_cap_5000"], "risk": 0.8375148703702585}
{"idx": 4, "question": "torsemide 사용량 사분위수(Q1-Q4)에 따른 AKI 진단 비율을 비교해줘. 전체 기간 / 전체 환자", "bucket": 4, "sql": "WITH torsemide_usage AS ( \n    SELECT ie.HADM_ID, SUM(ie.AMOUNT) AS total_dose \n    FROM INPUTEVENTS ie \n    JOIN D_ITEMS di ON ie.ITEMID = di.ITEMID \n    WHERE ROWNUM <= 5000 AND LOWER(di.LABEL) LIKE '%torsemide%' \n    GROUP BY ie.HADM_ID \n), \nquartiles AS ( \n    SELECT tu.HADM_ID, NTILE(4) OVER (ORDER BY tu.total_dose) AS dose_quartile \n    FROM torsemide_usage tu \n), \naki_hadm AS ( \n    SELECT DISTINCT d.HADM_ID \n    FROM DIAGNOSES_ICD d \n    WHERE (d.ICD_VERSION = 10 AND d.ICD_CODE LIKE 'N17%') \n       OR (d.ICD_VERSION = 9 AND d.ICD_CODE LIKE '584%') \n) \nSELECT 'Q' || q.dose_quartile AS dose_quartile, \n       COUNT(DISTINCT q.HADM_ID) AS n_hadm, \n       COUNT(DISTINCT CASE WHEN a.HADM_ID IS NOT NULL THEN q.HADM_ID END) AS n_aki_hadm, \n       ROUND(100 * COUNT(DISTINCT CASE WHEN a.HADM_ID IS NOT NULL THEN q.HADM_ID END) / NULLIF(COUNT(DISTINCT q.HADM_ID), 0), 2) AS aki_diagnosis_rate_pct \nFROM quartiles q \nLEFT JOIN aki_hadm a ON a.HADM_ID = q.HADM_ID \nGROUP BY q.dose_quartile \nORDER BY q.dose_quartile", "checks": {"has_ntile": true, "has_group_by": true, "not_single_overall": true, "has_quantitative_usage": true, "has_med_source": true, "has_bucket_label": true, "has_aki_filter": true, "exec_ok": true, "row_count_positive": false}, "pass_core": true, "row_count": 0, "exec_err": null, "postprocess": ["table:d_items->D_ITEMS", "table:inputevents->INPUTEVENTS", "column:hadm_id->HADM_ID", "rownum_cap_5000"], "risk": 0.577}
{"idx": 5, "question": "furosemide usage quartile (Q1-Q4) by AKI diagnosis rate. full period, all patients", "bucket": 4, "sql": "WITH loop_rx AS ( \n    SELECT p.HADM_ID, SUM(NVL(p.doses_per_24_hrs, 0)) AS loop_dose \n    FROM PRESCRIPTIONS p \n    WHERE ROWNUM <= 5000 AND p.HADM_ID IS NOT NULL AND LOWER(p.drug) LIKE '%furosemide%' \n    GROUP BY p.HADM_ID \n), \ndose_q AS ( \n    SELECT HADM_ID, loop_dose, NTILE(4) OVER (ORDER BY loop_dose) AS qtile \n    FROM loop_rx \n), \naki_hadm AS ( \n    SELECT DISTINCT d.HADM_ID \n    FROM DIAGNOSES_ICD d \n    WHERE (d.icd_version = 10 AND d.icd_code LIKE 'N17%') OR (d.icd_version = 9 AND d.icd_code LIKE '584%') \n) \nSELECT 'Q' || q.qtile AS dose_quartile, \n       COUNT(DISTINCT q.HADM_ID) AS n_hadm, \n       COUNT(DISTINCT CASE WHEN a.HADM_ID IS NOT NULL THEN q.HADM_ID END) AS n_aki_hadm, \n       ROUND(100 * COUNT(DISTINCT CASE WHEN a.HADM_ID IS NOT NULL THEN q.HADM_ID END) / NULLIF(COUNT(DISTINCT q.HADM_ID), 0), 2) AS aki_diagnosis_rate_pct \nFROM dose_q q \nLEFT JOIN aki_hadm a ON a.HADM_ID = q.HADM_ID \nGROUP BY q.qtile \nORDER BY q.qtile", "checks": {"has_ntile": true, "has_group_by": true, "not_single_overall": true, "has_quantitative_usage": true, "has_med_source": true, "has_bucket_label": true, "has_aki_filter": true, "exec_ok": true, "row_count_positive": true}, "pass_core": true, "row_count": 4, "exec_err": null, "postprocess": ["column:hadm_id->HADM_ID", "rownum_cap_5000"], "risk": 0.0}
{"idx": 6, "question": "Compare in-hospital mortality rate by quartile (Q1-Q4) of loop diuretics usage. full period", "bucket": 4, "sql": "WITH loop_rx AS ( \n    SELECT ie.HADM_ID, SUM(NVL(ie.amount, 0)) AS loop_dose \n    FROM INPUTEVENTS ie \n    JOIN D_ITEMS di ON ie.itemid = di.itemid \n    WHERE ROWNUM <= 5000 AND LOWER(di.label) LIKE '%furosemide%' OR LOWER(di.label) LIKE '%bumetanide%' \n       OR LOWER(di.label) LIKE '%torsemide%' OR LOWER(di.label) LIKE '%ethacrynic%' \n    GROUP BY ie.HADM_ID \n), \ndose_q AS ( \n    SELECT HADM_ID, loop_dose, NTILE(4) OVER (ORDER BY loop_dose) AS qtile \n    FROM loop_rx \n) \nSELECT 'Q' || d.qtile AS dose_quartile, \n       COUNT(DISTINCT d.HADM_ID) AS n_hadm, \n       COUNT(DISTINCT CASE WHEN a.HOSPITAL_EXPIRE_FLAG = 1 THEN d.HADM_ID END) AS n_mortality_hadm, \n       ROUND(100 * COUNT(DISTINCT CASE WHEN a.HOSPITAL_EXPIRE_FLAG = 1 THEN d.HADM_ID END) / NULLIF(COUNT(DISTINCT d.HADM_ID), 0), 2) AS mortality_rate_pct \nFROM dose_q d \nJOIN ADMISSIONS a ON d.HADM_ID = a.HADM_ID \nGROUP BY d.qtile \nORDER BY d.qtile", "checks": {"has_ntile": true, "has_group_by": true, "not_single_overall": true, "has_quantitative_usage": true, "has_med_source": true, "has_bucket_label": true, "has_aki_filter": true, "exec_ok": true, "row_count_positive": true}, "pass_core": true, "row_count": 4, "exec_err": null, "postprocess": ["table:d_items->D_ITEMS", "table:inputevents->INPUTEVENTS", "column:hospital_expire_flag->HOSPITAL_EXPIRE_FLAG", "column:hadm_id->HADM_ID", "rownum_cap_5000"], "risk": 0.784}
{"idx": 7, "question": "loop diuretics 사용량 decile(10분위)별 AKI 진단 비율을 비교해줘. 전체 기간", "bucket": 10, "sql": "WITH loop_rx AS ( SELECT p.HADM_ID, SUM(NVL(p.doses_per_24_hrs, 0)) AS loop_dose FROM PRESCRIPTIONS p WHERE ROWNUM <= 5000 AND p.HADM_ID IS NOT NULL AND (LOWER(p.drug) LIKE '%furosemide%' OR LOWER(p.drug) LIKE '%bumetanide%' OR LOWER(p.drug) LIKE '%torsemide%' OR LOWER(p.drug) LIKE '%ethacrynic%' OR LOWER(p.drug) LIKE '%loop diuretic%') GROUP BY p.HADM_ID ), dose_decile AS ( SELECT HADM_ID, loop_dose, NTILE(10) OVER (ORDER BY loop_dose) AS decile FROM loop_rx ), aki_hadm AS ( SELECT DISTINCT d.HADM_ID FROM DIAGNOSES_ICD d WHERE (d.icd_version = 10 AND d.icd_code LIKE 'N17%') OR (d.icd_version = 9 AND d.icd_code LIKE '584%') ) SELECT 'D' || d.decile AS dose_decile, COUNT(DISTINCT d.HADM_ID) AS n_hadm, COUNT(DISTINCT CASE WHEN a.HADM_ID IS NOT NULL THEN d.HADM_ID END) AS n_aki_hadm, ROUND(100 * COUNT(DISTINCT CASE WHEN a.HADM_ID IS NOT NULL THEN d.HADM_ID END) / NULLIF(COUNT(DISTINCT d.HADM_ID), 0), 2) AS aki_diagnosis_rate_pct FROM dose_decile d LEFT JOIN aki_hadm a ON a.HADM_ID = d.HADM_ID GROUP BY d.decile ORDER BY d.decile", "checks": {"has_ntile": true, "has_group_by": true, "not_single_overall": true, "has_quantitative_usage": true, "has_med_source": true, "has_bucket_label": true, "has_aki_filter": true, "exec_ok": true, "row_count_positive": true}, "pass_core": true, "row_count": 10, "exec_err": null, "postprocess": ["column:hadm_id->HADM_ID", "rownum_cap_5000"], "risk": 0.632}
{"idx": 8, "question": "norepinephrine 투여량 사분위수(Q1-Q4)별 병원 사망률을 비교해줘. 전체 기간", "bucket": 4, "sql": "WITH norepinephrine_use AS ( \n    SELECT i.HADM_ID, SUM(NVL(i.amount, 0)) AS total_norepinephrine_dose \n    FROM INPUTEVENTS i \n    WHERE ROWNUM <= 5000 AND i.itemid = (SELECT itemid FROM D_ITEMS WHERE LOWER(label) = 'norepinephrine') \n    GROUP BY i.HADM_ID \n), \nquartiles AS ( \n    SELECT \n        HADM_ID, \n        NTILE(4) OVER (ORDER BY total_norepinephrine_dose) AS dose_quartile \n    FROM norepinephrine_use \n), \ndose_mortality AS ( \n    SELECT \n        q.dose_quartile, \n        COUNT(DISTINCT q.HADM_ID) AS num_admissions, \n        COUNT(DISTINCT CASE WHEN a.HOSPITAL_EXPIRE_FLAG = 1 THEN q.HADM_ID END) AS num_deaths \n    FROM quartiles q \n    JOIN ADMISSIONS a ON q.HADM_ID = a.HADM_ID \n    GROUP BY q.dose_quartile \n) \nSELECT \n    'Q' || dose_quartile AS dose_quartile, \n    num_admissions, \n    (100 * num_deaths / NULLIF(num_admissions, 0)) AS mortality_rate_pct \nFROM dose_mortality \nORDER BY dose_quartile", "checks": {"has_ntile": true, "has_group_by": true, "not_single_overall": true, "has_quantitative_usage": true, "has_med_source": true, "has_bucket_label": true, "has_aki_filter": true, "exec_ok": true, "row_count_positive": true}, "pass_core": true, "row_count": 4, "exec_err": null, "postprocess": ["table:d_items->D_ITEMS", "table:inputevents->INPUTEVENTS", "column:hospital_expire_flag->HOSPITAL_EXPIRE_FLAG", "column:hadm_id->HADM_ID", "rownum_cap_5000"], "risk": 0.701}
{"idx": 9, "question": "vasopressor amount quartiles (Q1-Q4) and hospital mortality rate, compare each quartile", "bucket": 4, "sql": "WITH vasopressor_use AS ( SELECT ie.HADM_ID, SUM(NVL(ie.AMOUNT, 0)) AS total_vasopressor_amount FROM INPUTEVENTS ie JOIN ICUSTAYS icu ON ie.STAY_ID = icu.STAY_ID WHERE ROWNUM <= 5000 AND ie.ITEMID IN (SELECT ITEMID FROM INPUTEVENTS WHERE ITEMID IS NOT NULL) GROUP BY ie.HADM_ID ), vasopressor_quartiles AS ( SELECT HADM_ID, total_vasopressor_amount, NTILE(4) OVER (ORDER BY total_vasopressor_amount) AS quartile FROM vasopressor_use ) SELECT 'Q' || vq.quartile AS vasopressor_quartile, COUNT(DISTINCT vq.HADM_ID) AS n_hadm, COUNT(CASE WHEN a.HOSPITAL_EXPIRE_FLAG = 1 THEN 1 END) AS n_deaths, ROUND(100 * AVG(CASE WHEN a.HOSPITAL_EXPIRE_FLAG = 1 THEN 1 ELSE 0 END), 2) AS hospital_mortality_rate_pct FROM vasopressor_quartiles vq JOIN ADMISSIONS a ON vq.HADM_ID = a.HADM_ID GROUP BY vq.quartile ORDER BY vq.quartile", "checks": {"has_ntile": true, "has_group_by": true, "not_single_overall": true, "has_quantitative_usage": true, "has_med_source": true, "has_bucket_label": true, "has_aki_filter": true, "exec_ok": true, "row_count_positive": true}, "pass_core": true, "row_count": 4, "exec_err": null, "postprocess": ["table:inputevents->INPUTEVENTS", "column:hospital_expire_flag->HOSPITAL_EXPIRE_FLAG", "column:stay_id->STAY_ID", "column:hadm_id->HADM_ID", "rownum_cap_5000"], "risk": 0.602}
{"idx": 10, "question": "이뇨제 사용량 사분위수(Q1-Q4)별 AKI 비율 비교. 전체 기간", "bucket": 4, "sql": "WITH iv_use AS ( \n    SELECT i.HADM_ID, SUM(i.amount) AS total_amount \n    FROM INPUTEVENTS i \n    WHERE ROWNUM <= 5000 AND i.HADM_ID IS NOT NULL \n    GROUP BY i.HADM_ID \n), \namount_quartile AS ( \n    SELECT HADM_ID, total_amount, NTILE(4) OVER (ORDER BY total_amount) AS qtile \n    FROM iv_use \n), \naki_hadm AS ( \n    SELECT DISTINCT d.HADM_ID \n    FROM DIAGNOSES_ICD d \n    WHERE (d.icd_version = 10 AND d.icd_code LIKE 'N17%') \n       OR (d.icd_version = 9 AND d.icd_code LIKE '584%') \n) \nSELECT 'Q' || a.qtile AS infusion_quartile, \n       COUNT(DISTINCT a.HADM_ID) AS n_hadm, \n       COUNT(DISTINCT CASE WHEN ak.HADM_ID IS NOT NULL THEN a.HADM_ID END) AS n_aki_hadm, \n       ROUND(100 * COUNT(DISTINCT CASE WHEN ak.HADM_ID IS NOT NULL THEN a.HADM_ID END) / NULLIF(COUNT(DISTINCT a.HADM_ID), 0), 2) AS aki_diagnosis_rate_pct \nFROM amount_quartile a \nLEFT JOIN aki_hadm ak ON ak.HADM_ID = a.HADM_ID \nGROUP BY a.qtile \nORDER BY a.qtile", "checks": {"has_ntile": true, "has_group_by": true, "not_single_overall": true, "has_quantitative_usage": true, "has_med_source": true, "has_bucket_label": true, "has_aki_filter": true, "exec_ok": true, "row_count_positive": true}, "pass_core": true, "row_count": 4, "exec_err": null, "postprocess": ["table:inputevents->INPUTEVENTS", "column:hadm_id->HADM_ID", "rownum_cap_5000"], "risk": 0.9148178407985198}
