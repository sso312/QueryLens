{"idx": 1, "question": "loop diuretics(예: furosemide) 사용량 사분위수(Q1-Q4)에 따른 AKI 진단 비율을 비교해줘. 전체 기간 / 전체 환자", "sql": "WITH loop_rx AS ( \n    SELECT p.HADM_ID, SUM(NVL(p.doses_per_24_hrs, 0)) AS loop_dose \n    FROM PRESCRIPTIONS p \n    WHERE ROWNUM <= 5000 AND p.HADM_ID IS NOT NULL \n    AND (LOWER(p.drug) LIKE '%furosemide%' OR LOWER(p.drug) LIKE '%bumetanide%' OR LOWER(p.drug) LIKE '%torsemide%' OR LOWER(p.drug) LIKE '%ethacrynic%' OR LOWER(p.drug) LIKE '%loop diuretic%') \n    GROUP BY p.HADM_ID \n), \ndose_q AS ( \n    SELECT HADM_ID, loop_dose, NTILE(4) OVER (ORDER BY loop_dose) AS qtile \n    FROM loop_rx \n), \naki_hadm AS ( \n    SELECT DISTINCT d.HADM_ID \n    FROM DIAGNOSES_ICD d \n    WHERE (d.icd_version = 10 AND d.icd_code LIKE 'N17%') OR (d.icd_version = 9 AND d.icd_code LIKE '584%') \n) \nSELECT 'Q' || q.qtile AS dose_quartile, \n    COUNT(DISTINCT q.HADM_ID) AS n_hadm, \n    COUNT(DISTINCT CASE WHEN a.HADM_ID IS NOT NULL THEN q.HADM_ID END) AS n_aki_hadm, \n    ROUND(100 * COUNT(DISTINCT CASE WHEN a.HADM_ID IS NOT NULL THEN q.HADM_ID END) / NULLIF(COUNT(DISTINCT q.HADM_ID), 0), 2) AS aki_diagnosis_rate_pct \nFROM dose_q q \nLEFT JOIN aki_hadm a ON a.HADM_ID = q.HADM_ID \nGROUP BY q.qtile \nORDER BY q.qtile", "checks": {"has_ntile": true, "has_group_by": true, "has_quantitative_usage": true, "has_med_source": true, "has_med_filter_token": true, "has_aki_filter": true, "exec_ok": true}, "row_count": 4, "pass_strict": true}
{"idx": 2, "question": "푸로세미드 사용량 사분위수(Q1-Q4)별 병원 사망률을 비교해줘. 전체 기간 / 전체 환자", "sql": "WITH drug_rx AS ( \n    SELECT p.HADM_ID, \n           SUM(NVL(p.doses_per_24_hrs, 0)) AS dose_amt \n    FROM PRESCRIPTIONS p \n    WHERE ROWNUM <= 5000 AND LOWER(p.drug) LIKE '%furosemide%' \n    GROUP BY p.HADM_ID \n), \ndose_q AS ( \n    SELECT HADM_ID, dose_amt, NTILE(4) OVER (ORDER BY dose_amt) AS qtile \n    FROM drug_rx \n), \nadm AS ( \n    SELECT HADM_ID, HOSPITAL_EXPIRE_FLAG \n    FROM ADMISSIONS \n) \nSELECT 'Q' || q.qtile AS dose_quartile, \n       COUNT(DISTINCT q.HADM_ID) AS n_hadm, \n       COUNT(DISTINCT CASE WHEN a.HOSPITAL_EXPIRE_FLAG = 1 THEN q.HADM_ID END) AS n_death_hadm, \n       ROUND(100 * COUNT(DISTINCT CASE WHEN a.HOSPITAL_EXPIRE_FLAG = 1 THEN q.HADM_ID END) / NULLIF(COUNT(DISTINCT q.HADM_ID), 0), 2) AS hospital_mortality_rate_pct \nFROM dose_q q \nJOIN adm a ON a.HADM_ID = q.HADM_ID \nGROUP BY q.qtile \nORDER BY q.qtile", "checks": {"has_ntile": true, "has_group_by": true, "has_quantitative_usage": true, "has_med_source": true, "has_med_filter_token": true, "has_aki_filter": true, "exec_ok": true}, "row_count": 4, "pass_strict": true}
{"idx": 3, "question": "bumetanide 사용량 사분위수(Q1-Q4)에 따른 AKI 진단 비율을 비교해줘. 전체 기간 / 전체 환자", "sql": "WITH bumetanide_rx AS ( \n    SELECT i.HADM_ID, \n           SUM(NVL(i.amount, 0)) AS bumetanide_dose \n    FROM INPUTEVENTS i \n    WHERE ROWNUM <= 5000 AND i.HADM_ID IS NOT NULL \n      AND LOWER(i.itemid) IN (SELECT itemid FROM D_ITEMS WHERE LOWER(label) LIKE '%bumetanide%') \n    GROUP BY i.HADM_ID \n), \ndose_q AS ( \n    SELECT HADM_ID, \n           bumetanide_dose, \n           NTILE(4) OVER (ORDER BY bumetanide_dose) AS qtile \n    FROM bumetanide_rx \n), \naki_hadm AS ( \n    SELECT DISTINCT d.HADM_ID \n    FROM DIAGNOSES_ICD d \n    WHERE (d.icd_version = 10 AND d.icd_code LIKE 'N17%') \n       OR (d.icd_version = 9 AND d.icd_code LIKE '584%') \n) \nSELECT 'Q' || q.qtile AS dose_quartile, \n       COUNT(DISTINCT q.HADM_ID) AS n_hadm, \n       COUNT(DISTINCT CASE WHEN a.HADM_ID IS NOT NULL THEN q.HADM_ID END) AS n_aki_hadm, \n       ROUND(100 * COUNT(DISTINCT CASE WHEN a.HADM_ID IS NOT NULL THEN q.HADM_ID END) / NULLIF(COUNT(DISTINCT q.HADM_ID), 0), 2) AS aki_diagnosis_rate_pct \nFROM dose_q q \nLEFT JOIN aki_hadm a ON a.HADM_ID = q.HADM_ID \nGROUP BY q.qtile \nORDER BY q.qtile", "checks": {"has_ntile": true, "has_group_by": true, "has_quantitative_usage": true, "has_med_source": true, "has_med_filter_token": true, "has_aki_filter": true, "exec_ok": true}, "row_count": 4, "pass_strict": true}
{"idx": 4, "question": "torsemide 사용량 사분위수(Q1-Q4)에 따른 AKI 진단 비율을 비교해줘. 전체 기간 / 전체 환자", "sql": "WITH torsemide_rx AS ( \n    SELECT ie.HADM_ID, SUM(NVL(ie.amount, 0)) AS total_torsemide_dose \n    FROM INPUTEVENTS ie \n    WHERE ROWNUM <= 5000 AND LOWER(ie.itemid) LIKE '%torsemide%' \n    GROUP BY ie.HADM_ID \n), dose_q AS ( \n    SELECT HADM_ID, total_torsemide_dose, NTILE(4) OVER (ORDER BY total_torsemide_dose) AS qtile \n    FROM torsemide_rx \n), aki_hadm AS ( \n    SELECT DISTINCT d.HADM_ID \n    FROM DIAGNOSES_ICD d \n    WHERE (d.icd_version = 10 AND d.icd_code LIKE 'N17%') OR (d.icd_version = 9 AND d.icd_code LIKE '584%') \n) \nSELECT 'Q' || q.qtile AS dose_quartile, \n       COUNT(DISTINCT q.HADM_ID) AS n_hadm, \n       COUNT(DISTINCT CASE WHEN a.HADM_ID IS NOT NULL THEN q.HADM_ID END) AS n_aki_hadm, \n       ROUND(100 * COUNT(DISTINCT CASE WHEN a.HADM_ID IS NOT NULL THEN q.HADM_ID END) / NULLIF(COUNT(DISTINCT q.HADM_ID), 0), 2) AS aki_diagnosis_rate_pct \nFROM dose_q q \nLEFT JOIN aki_hadm a ON a.HADM_ID = q.HADM_ID \nGROUP BY q.qtile \nORDER BY q.qtile", "checks": {"has_ntile": true, "has_group_by": true, "has_quantitative_usage": true, "has_med_source": true, "has_med_filter_token": true, "has_aki_filter": true, "exec_ok": true}, "row_count": 0, "pass_strict": true}
{"idx": 5, "question": "furosemide usage quartile (Q1-Q4) by AKI diagnosis rate. full period, all patients", "sql": "WITH furosemide_usage AS ( SELECT ie.HADM_ID, SUM(ie.amount) AS total_amount FROM INPUTEVENTS ie JOIN D_ITEMS di ON ie.itemid = di.itemid WHERE ROWNUM <= 5000 AND LOWER(di.label) LIKE '%furosemide%' GROUP BY ie.HADM_ID ), usage_quartiles AS ( SELECT HADM_ID, total_amount, NTILE(4) OVER (ORDER BY total_amount) AS quartile FROM furosemide_usage ), aki_diagnoses AS ( SELECT DISTINCT di.HADM_ID FROM DIAGNOSES_ICD di WHERE (di.icd_version = 10 AND di.icd_code LIKE 'N17%') OR (di.icd_version = 9 AND di.icd_code LIKE '584%') ) SELECT 'Q' || uq.quartile AS furosemide_quartile, COUNT(DISTINCT uq.HADM_ID) AS total_admissions, COUNT(DISTINCT CASE WHEN ad.HADM_ID IS NOT NULL THEN uq.HADM_ID END) AS aki_cases, ROUND(100 * COUNT(DISTINCT CASE WHEN ad.HADM_ID IS NOT NULL THEN uq.HADM_ID END) / NULLIF(COUNT(DISTINCT uq.HADM_ID), 0), 2) AS aki_rate_pct FROM usage_quartiles uq LEFT JOIN aki_diagnoses ad ON uq.HADM_ID = ad.HADM_ID GROUP BY uq.quartile ORDER BY uq.quartile", "checks": {"has_ntile": true, "has_group_by": true, "has_quantitative_usage": true, "has_med_source": true, "has_med_filter_token": true, "has_aki_filter": true, "exec_ok": true}, "row_count": 4, "pass_strict": true}
{"idx": 6, "question": "Compare in-hospital mortality rate by quartile (Q1-Q4) of loop diuretics usage. full period", "sql": "WITH loop_diuretic_usage AS ( \n    SELECT ie.HADM_ID, \n           SUM(ie.AMOUNT) AS total_amount \n    FROM INPUTEVENTS ie \n    JOIN D_ITEMS di ON ie.ITEMID = di.ITEMID \n    WHERE ROWNUM <= 5000 AND LOWER(di.LABEL) LIKE '%furosemide%' \n       OR LOWER(di.LABEL) LIKE '%bumetanide%' \n       OR LOWER(di.LABEL) LIKE '%torsemide%' \n       OR LOWER(di.LABEL) LIKE '%ethacrynic%' \n       OR LOWER(di.LABEL) LIKE '%loop diuretic%' \n    GROUP BY ie.HADM_ID \n), usage_quartiles AS ( \n    SELECT HADM_ID, total_amount, NTILE(4) OVER (ORDER BY total_amount) AS quartile \n    FROM loop_diuretic_usage \n) \nSELECT 'Q' || q.quartile AS dose_quartile, \n       COUNT(DISTINCT a.HADM_ID) AS n_hadm, \n       COUNT(DISTINCT CASE WHEN a.HOSPITAL_EXPIRE_FLAG = 1 THEN a.HADM_ID END) AS n_deaths, \n       ROUND(100 * COUNT(DISTINCT CASE WHEN a.HOSPITAL_EXPIRE_FLAG = 1 THEN a.HADM_ID END) / NULLIF(COUNT(DISTINCT a.HADM_ID), 0), 2) AS mortality_rate_pct \nFROM usage_quartiles q \nJOIN ADMISSIONS a ON a.HADM_ID = q.HADM_ID \nGROUP BY q.quartile \nORDER BY q.quartile", "checks": {"has_ntile": true, "has_group_by": true, "has_quantitative_usage": true, "has_med_source": true, "has_med_filter_token": true, "has_aki_filter": true, "exec_ok": true}, "row_count": 4, "pass_strict": true}
{"idx": 7, "question": "loop diuretics 사용량 decile(10분위)별 AKI 진단 비율을 비교해줘. 전체 기간", "sql": "WITH loop_rx AS ( \n    SELECT p.HADM_ID, SUM(NVL(p.DRUG_DOSE, 0)) AS loop_dose \n    FROM PRESCRIPTIONS p \n    WHERE ROWNUM <= 5000 AND p.HADM_ID IS NOT NULL \n    AND (LOWER(p.drug_name_generic) LIKE '%furosemide%' \n         OR LOWER(p.drug_name_generic) LIKE '%bumetanide%' \n         OR LOWER(p.drug_name_generic) LIKE '%torsemide%' \n         OR LOWER(p.drug_name_generic) LIKE '%ethacrynic%' \n         OR LOWER(p.drug_name_generic) LIKE '%loop diuretic%') \n    GROUP BY p.HADM_ID \n), \n\ndose_decile AS ( \n    SELECT HADM_ID, loop_dose, NTILE(10) OVER (ORDER BY loop_dose) AS decile \n    FROM loop_rx \n), \n\naki_hadm AS ( \n    SELECT DISTINCT d.HADM_ID \n    FROM DIAGNOSES_ICD d \n    WHERE (d.icd_version = 10 AND d.icd_code LIKE 'N17%') \n       OR (d.icd_version = 9 AND d.icd_code LIKE '584%') \n) \n\nSELECT \n    'Decile ' || d.decile AS dose_decile, \n    COUNT(DISTINCT d.HADM_ID) AS n_hadm, \n    COUNT(DISTINCT CASE WHEN a.HADM_ID IS NOT NULL THEN d.HADM_ID END) AS n_aki_hadm, \n    ROUND(100 * COUNT(DISTINCT CASE WHEN a.HADM_ID IS NOT NULL THEN d.HADM_ID END) / NULLIF(COUNT(DISTINCT d.HADM_ID), 0), 2) AS aki_diagnosis_rate_pct \nFROM dose_decile d \nLEFT JOIN aki_hadm a ON a.HADM_ID = d.HADM_ID \nGROUP BY d.decile \nORDER BY d.decile", "checks": {"has_ntile": true, "has_group_by": true, "has_quantitative_usage": true, "has_med_source": true, "has_med_filter_token": true, "has_aki_filter": true, "exec_ok": false}, "row_count": 0, "pass_strict": false}
{"idx": 8, "question": "norepinephrine 투여량 사분위수(Q1-Q4)별 병원 사망률을 비교해줘. 전체 기간", "sql": "WITH norepinephrine_dose AS ( \n    SELECT ie.HADM_ID, \n           SUM(NVL(ie.AMOUNT, 0)) AS total_dose \n    FROM INPUTEVENTS ie \n    WHERE ROWNUM <= 5000 AND ie.ITEMID IN ( -- Assuming specific ITEMID for norepinephrine \n        SELECT DISTINCT ITEMID \n        FROM D_ITEMS \n        WHERE LOWER(LABEL) LIKE '%norepinephrine%' \n    ) \n    GROUP BY ie.HADM_ID \n), dose_quartiles AS ( \n    SELECT HADM_ID, total_dose, \n           NTILE(4) OVER (ORDER BY total_dose) AS quartile \n    FROM norepinephrine_dose \n), mortality_rates AS ( \n    SELECT dq.quartile, \n           COUNT(DISTINCT dq.HADM_ID) AS num_admissions, \n           COUNT(DISTINCT CASE WHEN a.HOSPITAL_EXPIRE_FLAG = 1 THEN dq.HADM_ID END) AS num_deaths, \n           ROUND(100 * COUNT(DISTINCT CASE WHEN a.HOSPITAL_EXPIRE_FLAG = 1 THEN dq.HADM_ID END) / NULLIF(COUNT(DISTINCT dq.HADM_ID), 0), 2) AS mortality_rate \n    FROM dose_quartiles dq \n    JOIN ADMISSIONS a ON dq.HADM_ID = a.HADM_ID \n    GROUP BY dq.quartile \n) \nSELECT 'Q' || quartile AS dose_quartile, num_admissions, num_deaths, mortality_rate \nFROM mortality_rates \nORDER BY quartile", "checks": {"has_ntile": true, "has_group_by": true, "has_quantitative_usage": true, "has_med_source": true, "has_med_filter_token": true, "has_aki_filter": true, "exec_ok": true}, "row_count": 4, "pass_strict": true}
{"idx": 9, "question": "vasopressor amount quartiles (Q1-Q4) and hospital mortality rate, compare each quartile", "sql": "WITH vasopressor_amt AS ( SELECT i.HADM_ID, SUM(NVL(i.AMOUNT, 0)) AS total_amt FROM INPUTEVENTS i WHERE ROWNUM <= 5000 AND i.ITEMID IN (SELECT DISTINCT ITEMID FROM ITEMS WHERE LOWER(LABEL) LIKE '%vasopressor%') GROUP BY i.HADM_ID ), amt_quartiles AS ( SELECT HADM_ID, total_amt, NTILE(4) OVER (ORDER BY total_amt) AS quartile FROM vasopressor_amt ), mortality AS ( SELECT HADM_ID, HOSPITAL_EXPIRE_FLAG FROM ADMISSIONS ) SELECT 'Q' || a.quartile AS amt_quartile, COUNT(DISTINCT a.HADM_ID) AS n_hadm, COUNT(DISTINCT CASE WHEN m.HOSPITAL_EXPIRE_FLAG = 1 THEN a.HADM_ID END) AS n_death_hadm, ROUND(100 * COUNT(DISTINCT CASE WHEN m.HOSPITAL_EXPIRE_FLAG = 1 THEN a.HADM_ID END) / NULLIF(COUNT(DISTINCT a.HADM_ID), 0), 2) AS hospital_mortality_rate_pct FROM amt_quartiles a JOIN mortality m ON a.HADM_ID = m.HADM_ID GROUP BY a.quartile ORDER BY a.quartile", "checks": {"has_ntile": true, "has_group_by": true, "has_quantitative_usage": true, "has_med_source": true, "has_med_filter_token": true, "has_aki_filter": true, "exec_ok": false}, "row_count": 0, "pass_strict": false}
{"idx": 10, "question": "이뇨제 사용량 사분위수(Q1-Q4)별 AKI 비율 비교. 전체 기간", "sql": "WITH diuretic_use AS ( SELECT ie.HADM_ID, SUM(ie.AMOUNT) AS total_amount FROM INGREDIENTEVENTS ie JOIN D_ITEMS di ON ie.ITEMID = di.ITEMID WHERE LOWER(di.LABEL) LIKE '%furosemide%' OR LOWER(di.LABEL) LIKE '%bumetanide%' OR LOWER(di.LABEL) LIKE '%torsemide%' OR LOWER(di.LABEL) LIKE '%ethacrynic%' OR LOWER(di.LABEL) LIKE '%spironolactone%' OR LOWER(di.LABEL) LIKE '%hydrochlorothiazide%' OR LOWER(di.LABEL) LIKE '%diuretic%' GROUP BY ie.HADM_ID ), diuretic_quartiles AS ( SELECT HADM_ID, total_amount, NTILE(4) OVER (ORDER BY total_amount) AS quartile FROM diuretic_use ), aki_diagnoses AS ( SELECT DISTINCT d.HADM_ID FROM DIAGNOSES_ICD d WHERE (d.ICD_VERSION = 10 AND d.ICD_CODE LIKE 'N17%') OR (d.ICD_VERSION = 9 AND d.ICD_CODE LIKE '584%') ) SELECT 'Q' || dq.quartile AS diuretic_quartile, COUNT(DISTINCT dq.HADM_ID) AS admissions, COUNT(DISTINCT CASE WHEN ad.HADM_ID IS NOT NULL THEN dq.HADM_ID END) AS aki_cases, ROUND(100 * COUNT(DISTINCT CASE WHEN ad.HADM_ID IS NOT NULL THEN dq.HADM_ID END) / NULLIF(COUNT(DISTINCT dq.HADM_ID), 0), 2) AS aki_rate FROM diuretic_quartiles dq LEFT JOIN aki_diagnoses ad ON dq.HADM_ID = ad.HADM_ID GROUP BY dq.quartile ORDER BY dq.quartile", "checks": {"has_ntile": true, "has_group_by": true, "has_quantitative_usage": true, "has_med_source": false, "has_med_filter_token": true, "has_aki_filter": true, "exec_ok": true}, "row_count": 0, "pass_strict": false}
