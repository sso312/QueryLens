{"idx": 1, "question": "loop diuretics(예: furosemide) 사용량 사분위수(Q1-Q4)에 따른 AKI 진단 비율을 비교해줘. 전체 기간 / 전체 환자", "pass_strict": true, "checks": {"has_ntile": true, "has_group_by": true, "has_quantitative_usage": true, "has_med_source": true, "has_med_filter_token": true, "has_aki_filter": true, "exec_ok": true}, "row_count": 4, "sql": "WITH loop_rx AS ( \n    SELECT p.HADM_ID, SUM(NVL(p.doses_per_24_hrs, 0)) AS loop_dose \n    FROM PRESCRIPTIONS p \n    WHERE ROWNUM <= 5000 AND p.HADM_ID IS NOT NULL \n      AND (LOWER(p.drug) LIKE '%furosemide%' OR LOWER(p.drug) LIKE '%bumetanide%' OR LOWER(p.drug) LIKE '%torsemide%' OR LOWER(p.drug) LIKE '%ethacrynic%') \n    GROUP BY p.HADM_ID \n  ), \n  dose_q AS ( \n    SELECT HADM_ID, loop_dose, NTILE(4) OVER (ORDER BY loop_dose) AS qtile \n    FROM loop_rx \n  ), \n  aki_hadm AS ( \n    SELECT DISTINCT d.HADM_ID \n    FROM DIAGNOSES_ICD d \n    WHERE (d.icd_version = 10 AND d.icd_code LIKE 'N17%') OR (d.icd_version = 9 AND d.icd_code LIKE '584%') \n  ) \nSELECT 'Q' || q.qtile AS dose_quartile, \n       COUNT(DISTINCT q.HADM_ID) AS n_hadm, \n       COUNT(DISTINCT CASE WHEN a.HADM_ID IS NOT NULL THEN q.HADM_ID END) AS n_aki_hadm, \n       ROUND(100 * COUNT(DISTINCT CASE WHEN a.HADM_ID IS NOT NULL THEN q.HADM_ID END) / NULLIF(COUNT(DISTINCT q.HADM_ID), 0), 2) AS aki_diagnosis_rate_pct \nFROM dose_q q \nLEFT JOIN aki_hadm a ON a.HADM_ID = q.HADM_ID \nGROUP BY q.qtile \nORDER BY q.qtile"}
{"idx": 2, "question": "푸로세미드 사용량 사분위수(Q1-Q4)별 병원 사망률을 비교해줘. 전체 기간 / 전체 환자", "pass_strict": true, "checks": {"has_ntile": true, "has_group_by": true, "has_quantitative_usage": true, "has_med_source": true, "has_med_filter_token": true, "has_aki_filter": true, "exec_ok": true}, "row_count": 4, "sql": "WITH drug_rx AS ( \n    SELECT p.HADM_ID, SUM(NVL(p.doses_per_24_hrs, 0)) AS dose_amt \n    FROM PRESCRIPTIONS p \n    WHERE ROWNUM <= 5000 AND p.HADM_ID IS NOT NULL AND LOWER(p.drug) LIKE '%furosemide%' \n    GROUP BY p.HADM_ID \n), \nranked_rx AS ( \n    SELECT HADM_ID, dose_amt, NTILE(4) OVER (ORDER BY dose_amt) AS qtile \n    FROM drug_rx \n), \nadm AS ( \n    SELECT HADM_ID, HOSPITAL_EXPIRE_FLAG \n    FROM ADMISSIONS \n    WHERE HADM_ID IS NOT NULL \n) \nSELECT 'Q' || r.qtile AS dose_quartile, \n    COUNT(DISTINCT r.HADM_ID) AS n_hadm, \n    COUNT(DISTINCT CASE WHEN a.HOSPITAL_EXPIRE_FLAG = 1 THEN r.HADM_ID END) AS n_death_hadm, \n    ROUND(100 * COUNT(DISTINCT CASE WHEN a.HOSPITAL_EXPIRE_FLAG = 1 THEN r.HADM_ID END) / NULLIF(COUNT(DISTINCT r.HADM_ID), 0), 2) AS hospital_mortality_rate_pct \nFROM ranked_rx r \nJOIN adm a ON a.HADM_ID = r.HADM_ID \nGROUP BY r.qtile \nORDER BY r.qtile"}
{"idx": 3, "question": "bumetanide 사용량 사분위수(Q1-Q4)에 따른 AKI 진단 비율을 비교해줘. 전체 기간 / 전체 환자", "pass_strict": true, "checks": {"has_ntile": true, "has_group_by": true, "has_quantitative_usage": true, "has_med_source": true, "has_med_filter_token": true, "has_aki_filter": true, "exec_ok": true}, "row_count": 0, "sql": "WITH bumetanide_rx AS ( SELECT p.HADM_ID, SUM(NVL(p.amount, 0)) AS bumetanide_dose FROM INPUTEVENTS p WHERE ROWNUM <= 5000 AND p.HADM_ID IS NOT NULL AND (LOWER(p.itemid) = 'bumetanide') GROUP BY p.HADM_ID ), dose_q AS ( SELECT HADM_ID, bumetanide_dose, NTILE(4) OVER (ORDER BY bumetanide_dose) AS qtile FROM bumetanide_rx ), aki_hadm AS ( SELECT DISTINCT d.HADM_ID FROM DIAGNOSES_ICD d WHERE (d.icd_version = 10 AND d.icd_code LIKE 'N17%') OR (d.icd_version = 9 AND d.icd_code LIKE '584%') ) SELECT 'Q' || q.qtile AS dose_quartile, COUNT(DISTINCT q.HADM_ID) AS n_hadm, COUNT(DISTINCT CASE WHEN a.HADM_ID IS NOT NULL THEN q.HADM_ID END) AS n_aki_hadm, ROUND(100 * COUNT(DISTINCT CASE WHEN a.HADM_ID IS NOT NULL THEN q.HADM_ID END) / NULLIF(COUNT(DISTINCT q.HADM_ID), 0), 2) AS aki_diagnosis_rate_pct FROM dose_q q LEFT JOIN aki_hadm a ON a.HADM_ID = q.HADM_ID GROUP BY q.qtile ORDER BY q.qtile"}
{"idx": 4, "question": "torsemide 사용량 사분위수(Q1-Q4)에 따른 AKI 진단 비율을 비교해줘. 전체 기간 / 전체 환자", "pass_strict": true, "checks": {"has_ntile": true, "has_group_by": true, "has_quantitative_usage": true, "has_med_source": true, "has_med_filter_token": true, "has_aki_filter": true, "exec_ok": true}, "row_count": 0, "sql": "WITH torsemide_rx AS ( \n  SELECT i.HADM_ID, SUM(NVL(i.amount, 0)) AS torsemide_dose \n  FROM INPUTEVENTS i \n  WHERE ROWNUM <= 5000 AND i.HADM_ID IS NOT NULL \n    AND LOWER(i.ITEMID) IN (SELECT ITEMID FROM D_ITEMS WHERE LOWER(LABEL) LIKE '%torsemide%') \n  GROUP BY i.HADM_ID \n), \n  dose_q AS ( \n    SELECT HADM_ID, torsemide_dose, NTILE(4) OVER (ORDER BY torsemide_dose) AS qtile \n    FROM torsemide_rx \n  ), \n  aki_hadm AS ( \n    SELECT DISTINCT d.HADM_ID \n    FROM DIAGNOSES_ICD d \n    WHERE (d.icd_version = 10 AND d.icd_code LIKE 'N17%') \n       OR (d.icd_version = 9 AND d.icd_code LIKE '584%') \n  ) \nSELECT 'Q' || q.qtile AS dose_quartile, \n       COUNT(DISTINCT q.HADM_ID) AS n_hadm, \n       COUNT(DISTINCT CASE WHEN a.HADM_ID IS NOT NULL THEN q.HADM_ID END) AS n_aki_hadm, \n       ROUND(100 * COUNT(DISTINCT CASE WHEN a.HADM_ID IS NOT NULL THEN q.HADM_ID END) / NULLIF(COUNT(DISTINCT q.HADM_ID), 0), 2) AS aki_diagnosis_rate_pct \nFROM dose_q q \nLEFT JOIN aki_hadm a ON a.HADM_ID = q.HADM_ID \nGROUP BY q.qtile \nORDER BY q.qtile"}
{"idx": 5, "question": "furosemide usage quartile (Q1-Q4) by AKI diagnosis rate. full period, all patients", "pass_strict": true, "checks": {"has_ntile": true, "has_group_by": true, "has_quantitative_usage": true, "has_med_source": true, "has_med_filter_token": true, "has_aki_filter": true, "exec_ok": true}, "row_count": 4, "sql": "WITH furosemide_usage AS ( SELECT ie.HADM_ID, SUM(NVL(ie.amount, 0)) AS total_furosemide_dose FROM INPUTEVENTS ie JOIN D_ITEMS di ON ie.itemid = di.itemid WHERE ROWNUM <= 5000 AND LOWER(di.label) LIKE '%furosemide%' GROUP BY ie.HADM_ID ), usage_quartiles AS ( SELECT HADM_ID, NTILE(4) OVER (ORDER BY total_furosemide_dose) AS dose_quartile FROM furosemide_usage ), aki_diagnoses AS ( SELECT DISTINCT HADM_ID FROM DIAGNOSES_ICD WHERE (icd_version = 10 AND icd_code LIKE 'N17%') OR (icd_version = 9 AND icd_code LIKE '584%') ) SELECT 'Q' || q.dose_quartile AS dose_quartile, COUNT(DISTINCT q.HADM_ID) AS n_hadm, COUNT(DISTINCT CASE WHEN ad.HADM_ID IS NOT NULL THEN q.HADM_ID END) AS n_aki_hadm, ROUND(100.0 * COUNT(DISTINCT CASE WHEN ad.HADM_ID IS NOT NULL THEN q.HADM_ID END) / NULLIF(COUNT(DISTINCT q.HADM_ID), 0), 2) AS aki_diagnosis_rate_pct FROM usage_quartiles q LEFT JOIN aki_diagnoses ad ON ad.HADM_ID = q.HADM_ID GROUP BY q.dose_quartile ORDER BY q.dose_quartile"}
{"idx": 6, "question": "Compare in-hospital mortality rate by quartile (Q1-Q4) of loop diuretics usage. full period", "pass_strict": true, "checks": {"has_ntile": true, "has_group_by": true, "has_quantitative_usage": true, "has_med_source": true, "has_med_filter_token": true, "has_aki_filter": true, "exec_ok": true}, "row_count": 4, "sql": "WITH loop_rx AS ( \n    SELECT ie.HADM_ID, SUM(NVL(ie.amount, 0)) AS loop_dose \n    FROM INPUTEVENTS ie \n    JOIN D_ITEMS di ON ie.itemid = di.itemid \n    WHERE ROWNUM <= 5000 AND LOWER(di.label) LIKE '%furosemide%' \n       OR LOWER(di.label) LIKE '%bumetanide%' \n       OR LOWER(di.label) LIKE '%torsemide%' \n       OR LOWER(di.label) LIKE '%ethacrynic%' \n       OR LOWER(di.label) LIKE '%loop diuretic%' \n    GROUP BY ie.HADM_ID \n), \ndose_q AS ( \n    SELECT HADM_ID, loop_dose, NTILE(4) OVER (ORDER BY loop_dose) AS qtile \n    FROM loop_rx \n) \nSELECT 'Q' || q.qtile AS dose_quartile, \n       COUNT(DISTINCT q.HADM_ID) AS n_hadm, \n       COUNT(DISTINCT CASE WHEN a.HOSPITAL_EXPIRE_FLAG = 1 THEN q.HADM_ID END) AS n_deaths, \n       ROUND(100 * COUNT(DISTINCT CASE WHEN a.HOSPITAL_EXPIRE_FLAG = 1 THEN q.HADM_ID END) / NULLIF(COUNT(DISTINCT q.HADM_ID), 0), 2) AS mortality_rate_pct \nFROM dose_q q \nJOIN ADMISSIONS a ON a.HADM_ID = q.HADM_ID \nGROUP BY q.qtile \nORDER BY q.qtile"}
{"idx": 7, "question": "loop diuretics 사용량 decile(10분위)별 AKI 진단 비율을 비교해줘. 전체 기간", "pass_strict": true, "checks": {"has_ntile": true, "has_group_by": true, "has_quantitative_usage": true, "has_med_source": true, "has_med_filter_token": true, "has_aki_filter": true, "exec_ok": true}, "row_count": 10, "sql": "WITH loop_rx AS ( \n    SELECT p.HADM_ID, SUM(NVL(p.doses_per_24_hrs, 0)) AS loop_dose \n    FROM PRESCRIPTIONS p \n    WHERE ROWNUM <= 5000 AND p.HADM_ID IS NOT NULL \n    AND (LOWER(p.drug) LIKE '%furosemide%' OR LOWER(p.drug) LIKE '%bumetanide%' OR LOWER(p.drug) LIKE '%torsemide%' OR LOWER(p.drug) LIKE '%ethacrynic%' OR LOWER(p.drug) LIKE '%loop diuretic%') \n    GROUP BY p.HADM_ID \n), dose_decile AS ( \n    SELECT HADM_ID, loop_dose, NTILE(10) OVER (ORDER BY loop_dose) AS decile \n    FROM loop_rx \n), aki_hadm AS ( \n    SELECT DISTINCT d.HADM_ID \n    FROM DIAGNOSES_ICD d \n    WHERE (d.icd_version = 10 AND d.icd_code LIKE 'N17%') OR (d.icd_version = 9 AND d.icd_code LIKE '584%') \n) \nSELECT 'Decile ' || d.decile AS dose_decile, \n       COUNT(DISTINCT d.HADM_ID) AS n_hadm, \n       COUNT(DISTINCT CASE WHEN a.HADM_ID IS NOT NULL THEN d.HADM_ID END) AS n_aki_hadm, \n       ROUND(100 * COUNT(DISTINCT CASE WHEN a.HADM_ID IS NOT NULL THEN d.HADM_ID END) / NULLIF(COUNT(DISTINCT d.HADM_ID), 0), 2) AS aki_diagnosis_rate_pct \nFROM dose_decile d \nLEFT JOIN aki_hadm a ON a.HADM_ID = d.HADM_ID \nGROUP BY d.decile \nORDER BY d.decile"}
{"idx": 8, "question": "norepinephrine 투여량 사분위수(Q1-Q4)별 병원 사망률을 비교해줘. 전체 기간", "pass_strict": true, "checks": {"has_ntile": true, "has_group_by": true, "has_quantitative_usage": true, "has_med_source": true, "has_med_filter_token": true, "has_aki_filter": true, "exec_ok": true}, "row_count": 4, "sql": "WITH norepinephrine_usage AS ( \n    SELECT i.HADM_ID, SUM(NVL(i.AMOUNT, 0)) AS total_amount \n    FROM INPUTEVENTS i \n    JOIN D_ITEMS d ON i.ITEMID = d.ITEMID \n    WHERE ROWNUM <= 5000 AND LOWER(d.LABEL) LIKE '%norepinephrine%' \n    GROUP BY i.HADM_ID \n), usage_quartiles AS ( \n    SELECT HADM_ID, total_amount, NTILE(4) OVER (ORDER BY total_amount) AS quartile \n    FROM norepinephrine_usage \n), mortality_data AS ( \n    SELECT HADM_ID, HOSPITAL_EXPIRE_FLAG \n    FROM ADMISSIONS \n) \nSELECT 'Q' || q.quartile AS norepinephrine_quartile, \n       COUNT(DISTINCT q.HADM_ID) AS num_admissions, \n       COUNT(DISTINCT CASE WHEN m.HOSPITAL_EXPIRE_FLAG = 1 THEN q.HADM_ID END) AS deaths, \n       ROUND(100 * COUNT(DISTINCT CASE WHEN m.HOSPITAL_EXPIRE_FLAG = 1 THEN q.HADM_ID END) / NULLIF(COUNT(DISTINCT q.HADM_ID), 0), 2) AS mortality_rate_pct \nFROM usage_quartiles q \nJOIN mortality_data m ON q.HADM_ID = m.HADM_ID \nGROUP BY q.quartile \nORDER BY q.quartile"}
{"idx": 9, "question": "vasopressor amount quartiles (Q1-Q4) and hospital mortality rate, compare each quartile", "pass_strict": true, "checks": {"has_ntile": true, "has_group_by": true, "has_quantitative_usage": true, "has_med_source": true, "has_med_filter_token": true, "has_aki_filter": true, "exec_ok": true}, "row_count": 0, "sql": "WITH vasopressor_amt AS ( \n    SELECT ie.HADM_ID, \n           SUM(NVL(ie.amount, 0)) AS total_amount \n    FROM INPUTEVENTS ie \n    WHERE ROWNUM <= 5000 AND ie.HADM_ID IS NOT NULL \n      AND LOWER(ie.itemid) IN (SELECT itemid FROM D_ITEMS WHERE LOWER(label) LIKE '%vasopressor%') \n    GROUP BY ie.HADM_ID \n), amount_quartiles AS ( \n    SELECT HADM_ID, total_amount, \n           NTILE(4) OVER (ORDER BY total_amount) AS qtile \n    FROM vasopressor_amt \n), \n     mortality_rate AS ( \n    SELECT a.HADM_ID, a.HOSPITAL_EXPIRE_FLAG \n    FROM ADMISSIONS a \n    WHERE a.HADM_ID IS NOT NULL \n) \nSELECT 'Q' || aq.qtile AS amount_quartile, \n       COUNT(DISTINCT aq.HADM_ID) AS n_hadm, \n       COUNT(DISTINCT CASE WHEN mr.HOSPITAL_EXPIRE_FLAG = 1 THEN aq.HADM_ID END) AS n_death_hadm, \n       ROUND(100 * COUNT(DISTINCT CASE WHEN mr.HOSPITAL_EXPIRE_FLAG = 1 THEN aq.HADM_ID END) / NULLIF(COUNT(DISTINCT aq.HADM_ID), 0), 2) AS hospital_mortality_rate_pct \nFROM amount_quartiles aq \nJOIN mortality_rate mr ON mr.HADM_ID = aq.HADM_ID \nGROUP BY aq.qtile \nORDER BY aq.qtile"}
{"idx": 10, "question": "이뇨제 사용량 사분위수(Q1-Q4)별 AKI 비율 비교. 전체 기간", "pass_strict": true, "checks": {"has_ntile": true, "has_group_by": true, "has_quantitative_usage": true, "has_med_source": true, "has_med_filter_token": true, "has_aki_filter": true, "exec_ok": true}, "row_count": 4, "sql": "WITH diuretic_usage AS ( SELECT ie.HADM_ID, SUM(NVL(ie.AMOUNT, 0)) AS total_amount FROM INPUTEVENTS ie JOIN D_ITEMS di ON ie.ITEMID = di.ITEMID WHERE ROWNUM <= 5000 AND LOWER(di.LABEL) LIKE '%furosemide%' OR LOWER(di.LABEL) LIKE '%bumetanide%' OR LOWER(di.LABEL) LIKE '%torsemide%' OR LOWER(di.LABEL) LIKE '%ethacrynic%' OR LOWER(di.LABEL) LIKE '%spironolactone%' OR LOWER(di.LABEL) LIKE '%hydrochlorothiazide%' OR LOWER(di.LABEL) LIKE '%diuretic%' GROUP BY ie.HADM_ID ), usage_quartile AS ( SELECT HADM_ID, total_amount, NTILE(4) OVER (ORDER BY total_amount) AS quartile FROM diuretic_usage ), aki_cases AS ( SELECT DISTINCT d.HADM_ID FROM DIAGNOSES_ICD d WHERE (d.ICD_VERSION = 10 AND d.ICD_CODE LIKE 'N17%') OR (d.ICD_VERSION = 9 AND d.ICD_CODE LIKE '584%') ) SELECT 'Q' || u.quartile AS usage_quartile, COUNT(DISTINCT u.HADM_ID) AS n_hadm, COUNT(DISTINCT CASE WHEN a.HADM_ID IS NOT NULL THEN u.HADM_ID END) AS n_aki_hadm, ROUND(100 * COUNT(DISTINCT CASE WHEN a.HADM_ID IS NOT NULL THEN u.HADM_ID END) / NULLIF(COUNT(DISTINCT u.HADM_ID), 0), 2) AS aki_rate_pct FROM usage_quartile u LEFT JOIN aki_cases a ON u.HADM_ID = a.HADM_ID GROUP BY u.quartile ORDER BY u.quartile"}
