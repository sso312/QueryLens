{"idx": 1, "question": "Compare AKI diagnosis rate by quartile (Q1-Q4) of loop diuretics usage, such as furosemide.", "expected_sql": "WITH loop_rx AS ( SELECT p.hadm_id, SUM(NVL(p.doses_per_24_hrs, 0)) AS loop_dose FROM PRESCRIPTIONS p WHERE p.hadm_id IS NOT NULL AND (LOWER(p.drug) LIKE '%furosemide%' OR LOWER(p.drug) LIKE '%bumetanide%' OR LOWER(p.drug) LIKE '%torsemide%' OR LOWER(p.drug) LIKE '%ethacrynic%' OR LOWER(p.drug) LIKE '%loop diuretic%') GROUP BY p.hadm_id ), dose_q AS ( SELECT hadm_id, loop_dose, NTILE(4) OVER (ORDER BY loop_dose) AS qtile FROM loop_rx ), aki_hadm AS ( SELECT DISTINCT d.hadm_id FROM DIAGNOSES_ICD d WHERE (d.icd_version = 10 AND d.icd_code LIKE 'N17%') OR (d.icd_version = 9 AND d.icd_code LIKE '584%') ) SELECT 'Q' || q.qtile AS dose_quartile, COUNT(DISTINCT q.hadm_id) AS n_hadm, COUNT(DISTINCT CASE WHEN a.hadm_id IS NOT NULL THEN q.hadm_id END) AS n_aki_hadm, ROUND(100 * COUNT(DISTINCT CASE WHEN a.hadm_id IS NOT NULL THEN q.hadm_id END) / NULLIF(COUNT(DISTINCT q.hadm_id), 0), 2) AS aki_diagnosis_rate_pct FROM dose_q q LEFT JOIN aki_hadm a ON a.hadm_id = q.hadm_id GROUP BY q.qtile ORDER BY q.qtile", "generated_sql": "SELECT usage_quartile, SUM(CASE WHEN aki_diagnosis = 1 THEN 1 ELSE 0 END) / NULLIF(COUNT(DISTINCT a.HADM_ID), 0) AS aki_diagnosis_rate FROM ( SELECT a.HADM_ID, NTILE(4) OVER (ORDER BY COALESCE(SUM(p.DOSES_PER_24_HRS), 0)) AS usage_quartile, MAX(CASE WHEN d.ICD_CODE LIKE 'N17%' AND d.ICD_VERSION = 10 OR d.ICD_CODE LIKE '584%' AND d.ICD_VERSION = 9 THEN 1 ELSE 0 END) AS aki_diagnosis FROM ADMISSIONS a LEFT JOIN PRESCRIPTIONS p ON a.HADM_ID = p.HADM_ID AND p.DRUG LIKE '%furosemide%' LEFT JOIN DIAGNOSES_ICD d ON a.HADM_ID = d.HADM_ID GROUP BY a.HADM_ID ) GROUP BY usage_quartile ORDER BY usage_quartile", "expected_error": null, "generated_error": "ORA-00904: \"A\".\"HADM_ID\": invalid identifier\nHelp: https://docs.oracle.com/error-help/db/ora-00904/", "status": "exec_error"}
{"idx": 2, "question": "ICU \uccab \ubcd1\ub3d9\ubcc4 \uac74\uc218\ub97c \ubcf4\uc5ec\uc918", "expected_sql": "SELECT FIRST_CAREUNIT, COUNT(*) AS cnt FROM ICUSTAYS WHERE FIRST_CAREUNIT IS NOT NULL GROUP BY FIRST_CAREUNIT ORDER BY cnt DESC", "generated_sql": "SELECT FIRST_CAREUNIT, COUNT(DISTINCT HADM_ID) AS CNT FROM ICUSTAYS GROUP BY FIRST_CAREUNIT", "expected_error": null, "generated_error": null, "status": "mismatch", "compare": {"same_cols": true, "same_rows": false, "expected_row_count": 16, "generated_row_count": 16}}
{"idx": 3, "question": "Top 10 stays by total output value", "expected_sql": "SELECT * FROM ( SELECT STAY_ID, SUM(VALUE) AS total_output FROM OUTPUTEVENTS WHERE VALUE IS NOT NULL GROUP BY STAY_ID ORDER BY total_output DESC ) WHERE ROWNUM <= 10", "generated_sql": "SELECT * FROM (SELECT oe.STAY_ID, SUM(oe.VALUE) AS total_output_value FROM OUTPUTEVENTS oe JOIN D_ITEMS di ON oe.ITEMID = di.ITEMID WHERE di.CATEGORY = 'Output' GROUP BY oe.STAY_ID ORDER BY total_output_value DESC) WHERE ROWNUM <= 10", "expected_error": null, "generated_error": null, "status": "mismatch", "compare": {"same_cols": false, "same_rows": false, "expected_row_count": 10, "generated_row_count": 10}}
{"idx": 4, "question": "Count medication administrations by medication name", "expected_sql": "SELECT * FROM ( SELECT MEDICATION, COUNT(*) AS cnt FROM EMAR WHERE MEDICATION IS NOT NULL GROUP BY MEDICATION ORDER BY cnt DESC ) WHERE ROWNUM <= 10", "generated_sql": "SELECT MEDICATION, COUNT(*) AS CNT FROM EMAR WHERE MEDICATION IS NOT NULL GROUP BY MEDICATION ORDER BY CNT DESC", "expected_error": "DPY-4024: call timeout of 15000 ms exceeded\nDPI-1067: call timeout of 15000 ms exceeded with ORA-03156\nORA-03156: OCI call timed out\nHelp: https://docs.oracle.com/error-help/db/ora-03156/", "generated_error": "DPY-4024: call timeout of 15000 ms exceeded\nDPI-1067: call timeout of 15000 ms exceeded with ORA-03156\nORA-03156: OCI call timed out\nHelp: https://docs.oracle.com/error-help/db/ora-03156/", "status": "exec_error"}
{"idx": 5, "question": "Top 10 procedure titles", "expected_sql": "SELECT * FROM ( SELECT d.LONG_TITLE, COUNT(*) AS cnt FROM PROCEDURES_ICD pr JOIN D_ICD_PROCEDURES d ON pr.ICD_CODE = d.ICD_CODE AND pr.ICD_VERSION = d.ICD_VERSION WHERE d.LONG_TITLE IS NOT NULL GROUP BY d.LONG_TITLE ORDER BY cnt DESC ) WHERE ROWNUM <= 10", "generated_sql": "SELECT * FROM (SELECT LONG_TITLE, COUNT(*) AS CNT FROM PROCEDURES_ICD JOIN D_ICD_PROCEDURES ON PROCEDURES_ICD.ICD_CODE = D_ICD_PROCEDURES.ICD_CODE AND PROCEDURES_ICD.ICD_VERSION = D_ICD_PROCEDURES.ICD_VERSION GROUP BY LONG_TITLE ORDER BY CNT DESC) WHERE ROWNUM <= 10", "expected_error": null, "generated_error": null, "status": "match", "compare": {"same_cols": true, "same_rows": true, "expected_row_count": 10, "generated_row_count": 10}}
